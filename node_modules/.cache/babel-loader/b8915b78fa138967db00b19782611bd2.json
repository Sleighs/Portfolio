{"ast":null,"code":"import { select } from 'd3-selection';\nimport { zoom, zoomTransform } from 'd3-zoom';\nimport { drag } from 'd3-drag';\nimport { min, max } from 'd3-array';\nimport { throttle } from 'lodash-es';\nimport TWEEN from '@tweenjs/tween.js';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport ColorTracker from 'canvas-color-tracker';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport { Bezier } from 'bezier-js';\nimport indexBy from 'index-array-by';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".force-graph-container canvas {\\n  display: block;\\n  user-select: none;\\n  outline: none;\\n  -webkit-tap-highlight-color: transparent;\\n}\\n\\n.force-graph-container .graph-tooltip {\\n  position: absolute;\\n  top: 0;\\n  font-family: sans-serif;\\n  font-size: 16px;\\n  padding: 4px;\\n  border-radius: 3px;\\n  color: #eee;\\n  background: rgba(0,0,0,0.65);\\n  visibility: hidden; /* by default */\\n}\\n\\n.force-graph-container .clickable {\\n  cursor: pointer;\\n}\\n\\n.force-graph-container .grabbable {\\n  cursor: move;\\n  cursor: grab;\\n  cursor: -moz-grab;\\n  cursor: -webkit-grab;\\n}\\n\\n.force-graph-container .grabbable:active {\\n  cursor: grabbing;\\n  cursor: -moz-grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\";\nstyleInject(css_248z);\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (null != _i) {\n    var _s,\n        _e,\n        _x,\n        _r,\n        _arr = [],\n        _n = !0,\n        _d = !1;\n\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    var _loop = function _loop() {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n\n        return \"continue\";\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n\n      if (_ret === \"continue\") continue;\n    }\n  }\n} //\n\n\nvar DAG_LEVEL_NODE_RATIO = 2; // whenever styling props are changed that require a canvas redraw\n\nvar notifyRedraw = function notifyRedraw(_, state) {\n  return state.onNeedsRedraw && state.onNeedsRedraw();\n};\n\nvar updDataPhotons = function updDataPhotons(_, state) {\n  if (!state.isShadow) {\n    // Add photon particles\n    var linkParticlesAccessor = accessorFn(state.linkDirectionalParticles);\n    state.graphData.links.forEach(function (link) {\n      var numPhotons = Math.round(Math.abs(linkParticlesAccessor(link)));\n\n      if (numPhotons) {\n        link.__photons = _toConsumableArray(Array(numPhotons)).map(function () {\n          return {};\n        });\n      } else {\n        delete link.__photons;\n      }\n    });\n  }\n};\n\nvar CanvasForceGraph = Kapsule({\n  props: {\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(_, state) {\n        state.engineRunning = false; // Pause simulation\n\n        updDataPhotons(_, state);\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, radialin, radialout\n        !dagMode && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    // area per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeColor: {\n      \"default\": 'color',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeAutoColorBy: {},\n    nodeCanvasObject: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeVisibility: {\n      \"default\": true,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkColor: {\n      \"default\": 'color',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkAutoColorBy: {},\n    linkLineDash: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkWidth: {\n      \"default\": 1,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCanvasObject: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowLength: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowColor: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalParticles: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: updDataPhotons\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    linkDirectionalParticleColor: {\n      triggerUpdate: false\n    },\n    globalScale: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.forceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.forceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.forceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNeedsRedraw: {\n      triggerUpdate: false\n    },\n    isShadow: {\n      \"default\": false,\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.forceLayout.force(forceName); // Force getter\n      }\n\n      state.forceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.forceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    isEngineRunning: function isEngineRunning(state) {\n      return !!state.engineRunning;\n    },\n    tickFrame: function tickFrame(state) {\n      !state.isShadow && layoutTick();\n      paintLinks();\n      !state.isShadow && paintArrows();\n      !state.isShadow && paintPhotons();\n      paintNodes();\n      return this; //\n\n      function layoutTick() {\n        if (state.engineRunning) {\n          if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin) {\n            state.engineRunning = false; // Stop ticking graph\n\n            state.onEngineStop();\n          } else {\n            state.forceLayout.tick(); // Tick it\n\n            state.onEngineTick();\n          }\n        }\n      }\n\n      function paintNodes() {\n        var getVisibility = accessorFn(state.nodeVisibility);\n        var getVal = accessorFn(state.nodeVal);\n        var getColor = accessorFn(state.nodeColor);\n        var getNodeCanvasObjectMode = accessorFn(state.nodeCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow / state.globalScale;\n        var visibleNodes = state.graphData.nodes.filter(getVisibility);\n        ctx.save();\n        visibleNodes.forEach(function (node) {\n          var nodeCanvasObjectMode = getNodeCanvasObjectMode(node);\n\n          if (state.nodeCanvasObject && (nodeCanvasObjectMode === 'before' || nodeCanvasObjectMode === 'replace')) {\n            // Custom node before/replace paint\n            state.nodeCanvasObject(node, ctx, state.globalScale);\n\n            if (nodeCanvasObjectMode === 'replace') {\n              ctx.restore();\n              return;\n            }\n          } // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n\n          var r = Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize + padAmount;\n          ctx.beginPath();\n          ctx.arc(node.x, node.y, r, 0, 2 * Math.PI, false);\n          ctx.fillStyle = getColor(node) || 'rgba(31, 120, 180, 0.92)';\n          ctx.fill();\n\n          if (state.nodeCanvasObject && nodeCanvasObjectMode === 'after') {\n            // Custom node after paint\n            state.nodeCanvasObject(node, state.ctx, state.globalScale);\n          }\n        });\n        ctx.restore();\n      }\n\n      function paintLinks() {\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkColor);\n        var getWidth = accessorFn(state.linkWidth);\n        var getLineDash = accessorFn(state.linkLineDash);\n        var getCurvature = accessorFn(state.linkCurvature);\n        var getLinkCanvasObjectMode = accessorFn(state.linkCanvasObjectMode);\n        var ctx = state.ctx; // Draw wider lines by 2px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n\n        var padAmount = state.isShadow * 2;\n        var visibleLinks = state.graphData.links.filter(getVisibility);\n        visibleLinks.forEach(calcLinkControlPoints); // calculate curvature control points for all visible links\n\n        var beforeCustomLinks = [],\n            afterCustomLinks = [],\n            defaultPaintLinks = visibleLinks;\n\n        if (state.linkCanvasObject) {\n          var replaceCustomLinks = [],\n              otherCustomLinks = [];\n          visibleLinks.forEach(function (d) {\n            return ({\n              before: beforeCustomLinks,\n              after: afterCustomLinks,\n              replace: replaceCustomLinks\n            }[getLinkCanvasObjectMode(d)] || otherCustomLinks).push(d);\n          });\n          defaultPaintLinks = [].concat(_toConsumableArray(beforeCustomLinks), afterCustomLinks, otherCustomLinks);\n          beforeCustomLinks = beforeCustomLinks.concat(replaceCustomLinks);\n        } // Custom link before paints\n\n\n        ctx.save();\n        beforeCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); // Bundle strokes per unique color/width/dash for performance optimization\n\n        var linksPerColor = indexBy(defaultPaintLinks, [getColor, getWidth, getLineDash]);\n        ctx.save();\n        Object.entries(linksPerColor).forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n              color = _ref2[0],\n              linksPerWidth = _ref2[1];\n\n          var lineColor = !color || color === 'undefined' ? 'rgba(0,0,0,0.15)' : color;\n          Object.entries(linksPerWidth).forEach(function (_ref3) {\n            var _ref4 = _slicedToArray(_ref3, 2),\n                width = _ref4[0],\n                linesPerLineDash = _ref4[1];\n\n            var lineWidth = (width || 1) / state.globalScale + padAmount;\n            Object.entries(linesPerLineDash).forEach(function (_ref5) {\n              var _ref6 = _slicedToArray(_ref5, 2);\n\n              _ref6[0];\n              var links = _ref6[1];\n              var lineDashSegments = getLineDash(links[0]);\n              ctx.beginPath();\n              links.forEach(function (link) {\n                var start = link.source;\n                var end = link.target;\n                if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n                ctx.moveTo(start.x, start.y);\n                var controlPoints = link.__controlPoints;\n\n                if (!controlPoints) {\n                  // Straight line\n                  ctx.lineTo(end.x, end.y);\n                } else {\n                  // Use quadratic curves for regular lines and bezier for loops\n                  ctx[controlPoints.length === 2 ? 'quadraticCurveTo' : 'bezierCurveTo'].apply(ctx, _toConsumableArray(controlPoints).concat([end.x, end.y]));\n                }\n              });\n              ctx.strokeStyle = lineColor;\n              ctx.lineWidth = lineWidth;\n              ctx.setLineDash(lineDashSegments || []);\n              ctx.stroke();\n            });\n          });\n        });\n        ctx.restore(); // Custom link after paints\n\n        ctx.save();\n        afterCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore(); //\n\n        function calcLinkControlPoints(link) {\n          var curvature = getCurvature(link);\n\n          if (!curvature) {\n            // straight line\n            link.__controlPoints = null;\n            return;\n          }\n\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var l = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2)); // line length\n\n          if (l > 0) {\n            var a = Math.atan2(end.y - start.y, end.x - start.x); // line angle\n\n            var d = l * curvature; // control point distance\n\n            var cp = {\n              // control point\n              x: (start.x + end.x) / 2 + d * Math.cos(a - Math.PI / 2),\n              y: (start.y + end.y) / 2 + d * Math.sin(a - Math.PI / 2)\n            };\n            link.__controlPoints = [cp.x, cp.y];\n          } else {\n            // Same point, draw a loop\n            var _d = curvature * 70;\n\n            link.__controlPoints = [end.x, end.y - _d, end.x + _d, end.y];\n          }\n        }\n      }\n\n      function paintArrows() {\n        var ARROW_WH_RATIO = 1.6;\n        var ARROW_VLEN_RATIO = 0.2;\n        var getLength = accessorFn(state.linkDirectionalArrowLength);\n        var getRelPos = accessorFn(state.linkDirectionalArrowRelPos);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalArrowColor || state.linkColor);\n        var getNodeVal = accessorFn(state.nodeVal);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var arrowLength = getLength(link);\n          if (!arrowLength || arrowLength < 0) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, getNodeVal(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, getNodeVal(end) || 1)) * state.nodeRelSize;\n          var arrowRelPos = Math.min(1, Math.max(0, getRelPos(link)));\n          var arrowColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          var arrowHalfWidth = arrowLength / ARROW_WH_RATIO / 2; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints && _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y]));\n\n          var getCoordsAlongLine = bzLine ? function (t) {\n            return bzLine.get(t);\n          } // get position along bezier line\n          : function (t) {\n            return {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * t || 0,\n              y: start.y + (end.y - start.y) * t || 0\n            };\n          };\n          var lineLen = bzLine ? bzLine.length() : Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getCoordsAlongLine(posAlongLine / lineLen);\n          var arrowTail = getCoordsAlongLine((posAlongLine - arrowLength) / lineLen);\n          var arrowTailVertex = getCoordsAlongLine((posAlongLine - arrowLength * (1 - ARROW_VLEN_RATIO)) / lineLen);\n          var arrowTailAngle = Math.atan2(arrowHead.y - arrowTail.y, arrowHead.x - arrowTail.x) - Math.PI / 2;\n          ctx.beginPath();\n          ctx.moveTo(arrowHead.x, arrowHead.y);\n          ctx.lineTo(arrowTail.x + arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y + arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.lineTo(arrowTailVertex.x, arrowTailVertex.y);\n          ctx.lineTo(arrowTail.x - arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y - arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.fillStyle = arrowColor;\n          ctx.fill();\n        });\n        ctx.restore();\n      }\n\n      function paintPhotons() {\n        var getNumPhotons = accessorFn(state.linkDirectionalParticles);\n        var getSpeed = accessorFn(state.linkDirectionalParticleSpeed);\n        var getDiameter = accessorFn(state.linkDirectionalParticleWidth);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalParticleColor || state.linkColor);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var numCyclePhotons = getNumPhotons(link);\n          if (!link.hasOwnProperty('__photons') || !link.__photons.length) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = getSpeed(link);\n          var photons = link.__photons || [];\n          var photonR = Math.max(0, getDiameter(link) / 2) / Math.sqrt(state.globalScale);\n          var photonColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          ctx.fillStyle = photonColor; // Construct bezier for curved lines\n\n          var bzLine = link.__controlPoints ? _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y])) : null;\n          var cyclePhotonIdx = 0;\n          var needsCleanup = false; // whether some photons need to be removed from list\n\n          photons.forEach(function (photon) {\n            var singleHop = !!photon.__singleHop;\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : cyclePhotonIdx / numCyclePhotons;\n            }\n\n            !singleHop && cyclePhotonIdx++; // increase regular photon index\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                needsCleanup = true;\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var coords = bzLine ? bzLine.get(photonPosRatio) // get position along bezier line\n            : {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * photonPosRatio || 0,\n              y: start.y + (end.y - start.y) * photonPosRatio || 0\n            };\n            ctx.beginPath();\n            ctx.arc(coords.x, coords.y, photonR, 0, 2 * Math.PI, false);\n            ctx.fill();\n          });\n\n          if (needsCleanup) {\n            // remove expired single hop photons\n            link.__photons = link.__photons.filter(function (photon) {\n              return !photon.__singleHop || photon.__progressRatio <= 1;\n            });\n          }\n        });\n        ctx.restore();\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        !link.__photons && (link.__photons = []);\n\n        link.__photons.push({\n          __singleHop: true\n        }); // add a single hop particle\n\n      }\n\n      return this;\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      forceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(canvasCtx, state) {\n    // Main canvas object to manipulate\n    state.ctx = canvasCtx;\n  },\n  update: function update(state) {\n    state.engineRunning = false; // Pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // parse links\n\n\n    state.graphData.links.forEach(function (link) {\n      link.source = link[state.linkSource];\n      link.target = link[state.linkTarget];\n    }); // Feed data to force-directed layout\n\n    state.forceLayout.stop().alpha(1) // re-heat the simulation\n    .nodes(state.graphData.nodes); // add links (if link force is still active)\n\n    var linkForce = state.forceLayout.force('link');\n\n    if (linkForce) {\n      linkForce.id(function (d) {\n        return d[state.nodeId];\n      }).links(state.graphData.links);\n    } // setup dag force constraints\n\n\n    var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n      return node[state.nodeId];\n    }, {\n      nodeFilter: state.dagNodeFilter,\n      onLoopError: state.onDagError || undefined\n    });\n    var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n    var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y for dag mode\n\n    if (state.dagMode) {\n      var getFFn = function getFFn(fix, invert) {\n        return function (node) {\n          return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n        };\n      };\n\n      var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n      var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'bu');\n      state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n        node.fx = fxFn(node);\n        node.fy = fyFn(node);\n      });\n    } // Use radial force for radial dags\n\n\n    state.forceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n      var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n      return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n    }).strength(function (node) {\n      return state.dagNodeFilter(node) ? 1 : 0;\n    }) : null);\n\n    for (var i = 0; i < state.warmupTicks && !(state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin); i++) {\n      state.forceLayout.tick();\n    } // Initial ticks before starting to render\n\n\n    this.resetCountdown();\n    state.onFinishUpdate();\n  }\n});\n\nfunction linkKapsule(kapsulePropNames, kapsuleType) {\n  var propNames = kapsulePropNames instanceof Array ? kapsulePropNames : [kapsulePropNames];\n  var dummyK = new kapsuleType(); // To extract defaults\n\n  return {\n    linkProp: function linkProp(prop) {\n      // link property config\n      return {\n        \"default\": dummyK[prop](),\n        onChange: function onChange(v, state) {\n          propNames.forEach(function (propName) {\n            return state[propName][prop](v);\n          });\n        },\n        triggerUpdate: false\n      };\n    },\n    linkMethod: function linkMethod(method) {\n      // link method pass-through\n      return function (state) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n\n        var returnVals = [];\n        propNames.forEach(function (propName) {\n          var kapsuleInstance = state[propName];\n          var returnVal = kapsuleInstance[method].apply(kapsuleInstance, args);\n\n          if (returnVal !== kapsuleInstance) {\n            returnVals.push(returnVal);\n          }\n        });\n        return returnVals.length ? returnVals[0] : this; // chain based on the parent object, not the inner kapsule\n      };\n    }\n  };\n}\n\nvar HOVER_CANVAS_THROTTLE_DELAY = 800; // ms to throttle shadow canvas updates for perf improvement\n\nvar ZOOM2NODES_FACTOR = 4; // Expose config from forceGraph\n\nvar bindFG = linkKapsule('forceGraph', CanvasForceGraph);\nvar bindBoth = linkKapsule(['forceGraph', 'shadowGraph'], CanvasForceGraph);\nvar linkedProps = Object.assign.apply(Object, _toConsumableArray(['nodeColor', 'nodeAutoColorBy', 'nodeCanvasObject', 'nodeCanvasObjectMode', 'linkColor', 'linkAutoColorBy', 'linkLineDash', 'linkWidth', 'linkCanvasObject', 'linkCanvasObjectMode', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowRelPos', 'linkDirectionalParticles', 'linkDirectionalParticleSpeed', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'dagMode', 'dagLevelDistance', 'dagNodeFilter', 'onDagError', 'd3AlphaMin', 'd3AlphaDecay', 'd3VelocityDecay', 'warmupTicks', 'cooldownTicks', 'cooldownTime', 'onEngineTick', 'onEngineStop'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkProp(p));\n})).concat(_toConsumableArray(['nodeRelSize', 'nodeId', 'nodeVal', 'nodeVisibility', 'linkSource', 'linkTarget', 'linkVisibility', 'linkCurvature'].map(function (p) {\n  return _defineProperty({}, p, bindBoth.linkProp(p));\n}))));\nvar linkedMethods = Object.assign.apply(Object, _toConsumableArray(['d3Force', 'd3ReheatSimulation', 'emitParticle'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkMethod(p));\n})));\n\nfunction adjustCanvasSize(state) {\n  if (state.canvas) {\n    var curWidth = state.canvas.width;\n    var curHeight = state.canvas.height;\n\n    if (curWidth === 300 && curHeight === 150) {\n      // Default canvas dimensions\n      curWidth = curHeight = 0;\n    }\n\n    var pxScale = window.devicePixelRatio; // 2 on retina displays\n\n    curWidth /= pxScale;\n    curHeight /= pxScale; // Resize canvases\n\n    [state.canvas, state.shadowCanvas].forEach(function (canvas) {\n      // Element size\n      canvas.style.width = \"\".concat(state.width, \"px\");\n      canvas.style.height = \"\".concat(state.height, \"px\"); // Memory size (scaled to avoid blurriness)\n\n      canvas.width = state.width * pxScale;\n      canvas.height = state.height * pxScale; // Normalize coordinate system to use css pixels (on init only)\n\n      if (!curWidth && !curHeight) {\n        canvas.getContext('2d').scale(pxScale, pxScale);\n      }\n    }); // Relative center panning based on 0,0\n\n    var k = zoomTransform(state.canvas).k;\n    state.zoom.translateBy(state.zoom.__baseElem, (state.width - curWidth) / 2 / k, (state.height - curHeight) / 2 / k);\n    state.needsRedraw = true;\n  }\n}\n\nfunction resetTransform(ctx) {\n  var pxRatio = window.devicePixelRatio;\n  ctx.setTransform(pxRatio, 0, 0, pxRatio, 0, 0);\n}\n\nfunction clearCanvas(ctx, width, height) {\n  ctx.save();\n  resetTransform(ctx); // reset transform\n\n  ctx.clearRect(0, 0, width, height);\n  ctx.restore(); //restore transforms\n} //\n\n\nvar forceGraph = Kapsule({\n  props: _objectSpread2({\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(d, state) {\n        [{\n          type: 'Node',\n          objs: d.nodes\n        }, {\n          type: 'Link',\n          objs: d.links\n        }].forEach(hexIndex);\n        state.forceGraph.graphData(d);\n        state.shadowGraph.graphData(d);\n\n        function hexIndex(_ref4) {\n          var type = _ref4.type,\n              objs = _ref4.objs;\n          objs.filter(function (d) {\n            if (!d.hasOwnProperty('__indexColor')) return true;\n            var cur = state.colorTracker.lookup(d.__indexColor);\n            return !cur || !cur.hasOwnProperty('d') || cur.d !== d;\n          }).forEach(function (d) {\n            // store object lookup color\n            d.__indexColor = state.colorTracker.register({\n              type: type,\n              d: d\n            });\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    backgroundColor: {\n      onChange: function onChange(color, state) {\n        state.canvas && color && (state.canvas.style.background = color);\n      },\n      triggerUpdate: false\n    },\n    nodeLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    nodePointerAreaPaint: {\n      onChange: function onChange(paintFn, state) {\n        state.shadowGraph.nodeCanvasObject(!paintFn ? null : function (node, ctx, globalScale) {\n          return paintFn(node, node.__indexColor, ctx, globalScale);\n        });\n        state.flushShadowCanvas && state.flushShadowCanvas();\n      },\n      triggerUpdate: false\n    },\n    linkPointerAreaPaint: {\n      onChange: function onChange(paintFn, state) {\n        state.shadowGraph.linkCanvasObject(!paintFn ? null : function (link, ctx, globalScale) {\n          return paintFn(link, link.__indexColor, ctx, globalScale);\n        });\n        state.flushShadowCanvas && state.flushShadowCanvas();\n      },\n      triggerUpdate: false\n    },\n    linkLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkHoverPrecision: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    minZoom: {\n      \"default\": 0.01,\n      onChange: function onChange(minZoom, state) {\n        state.zoom.scaleExtent([minZoom, state.zoom.scaleExtent()[1]]);\n      },\n      triggerUpdate: false\n    },\n    maxZoom: {\n      \"default\": 1000,\n      onChange: function onChange(maxZoom, state) {\n        state.zoom.scaleExtent([state.zoom.scaleExtent()[0], maxZoom]);\n      },\n      triggerUpdate: false\n    },\n    enableNodeDrag: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enablePanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomPanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    // to be deprecated\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        state.hoverObj = null;\n      },\n      triggerUpdate: false\n    },\n    autoPauseRedraw: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    onNodeDrag: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeDragEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeClick: {\n      triggerUpdate: false\n    },\n    onNodeRightClick: {\n      triggerUpdate: false\n    },\n    onNodeHover: {\n      triggerUpdate: false\n    },\n    onLinkClick: {\n      triggerUpdate: false\n    },\n    onLinkRightClick: {\n      triggerUpdate: false\n    },\n    onLinkHover: {\n      triggerUpdate: false\n    },\n    onBackgroundClick: {\n      triggerUpdate: false\n    },\n    onBackgroundRightClick: {\n      triggerUpdate: false\n    },\n    onZoom: {\n      triggerUpdate: false\n    },\n    onZoomEnd: {\n      triggerUpdate: false\n    },\n    onRenderFramePre: {\n      triggerUpdate: false\n    },\n    onRenderFramePost: {\n      triggerUpdate: false\n    }\n  }, linkedProps),\n  aliases: {\n    // Prop names supported for backwards compatibility\n    stopAnimation: 'pauseAnimation'\n  },\n  methods: _objectSpread2({\n    graph2ScreenCoords: function graph2ScreenCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: x * t.k + t.x,\n        y: y * t.k + t.y\n      };\n    },\n    screen2GraphCoords: function screen2GraphCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: (x - t.x) / t.k,\n        y: (y - t.y) / t.k\n      };\n    },\n    centerAt: function centerAt(state, x, y, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (x !== undefined || y !== undefined) {\n        var finalPos = Object.assign({}, x !== undefined ? {\n          x: x\n        } : {}, y !== undefined ? {\n          y: y\n        } : {});\n\n        if (!transitionDuration) {\n          // no animation\n          setCenter(finalPos);\n        } else {\n          new TWEEN.Tween(getCenter()).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCenter).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getCenter(); //\n\n      function getCenter() {\n        var t = zoomTransform(state.canvas);\n        return {\n          x: (state.width / 2 - t.x) / t.k,\n          y: (state.height / 2 - t.y) / t.k\n        };\n      }\n\n      function setCenter(_ref5) {\n        var x = _ref5.x,\n            y = _ref5.y;\n        state.zoom.translateTo(state.zoom.__baseElem, x === undefined ? getCenter().x : x, y === undefined ? getCenter().y : y);\n        state.needsRedraw = true;\n      }\n    },\n    zoom: function zoom(state, k, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n      // setter\n\n      if (k !== undefined) {\n        if (!transitionDuration) {\n          // no animation\n          setZoom(k);\n        } else {\n          new TWEEN.Tween({\n            k: getZoom()\n          }).to({\n            k: k\n          }, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function (_ref6) {\n            var k = _ref6.k;\n            return setZoom(k);\n          }).start();\n        }\n\n        return this;\n      } // getter\n\n\n      return getZoom(); //\n\n      function getZoom() {\n        return zoomTransform(state.canvas).k;\n      }\n\n      function setZoom(k) {\n        state.zoom.scaleTo(state.zoom.__baseElem, k);\n        state.needsRedraw = true;\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n\n      var bbox = this.getGraphBbox.apply(this, bboxArgs);\n\n      if (bbox) {\n        var center = {\n          x: (bbox.x[0] + bbox.x[1]) / 2,\n          y: (bbox.y[0] + bbox.y[1]) / 2\n        };\n        var zoomK = Math.max(1e-12, Math.min(1e12, (state.width - padding * 2) / (bbox.x[1] - bbox.x[0]), (state.height - padding * 2) / (bbox.y[1] - bbox.y[0])));\n        this.centerAt(center.x, center.y, transitionDuration);\n        this.zoom(zoomK, transitionDuration);\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var getVal = accessorFn(state.nodeVal);\n\n      var getR = function getR(node) {\n        return Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize;\n      };\n\n      var nodesPos = state.graphData.nodes.filter(nodeFilter).map(function (node) {\n        return {\n          x: node.x,\n          y: node.y,\n          r: getR(node)\n        };\n      });\n      return !nodesPos.length ? null : {\n        x: [min(nodesPos, function (node) {\n          return node.x - node.r;\n        }), max(nodesPos, function (node) {\n          return node.x + node.r;\n        })],\n        y: [min(nodesPos, function (node) {\n          return node.y - node.r;\n        }), max(nodesPos, function (node) {\n          return node.y + node.r;\n        })]\n      };\n    },\n    pauseAnimation: function pauseAnimation(state) {\n      if (state.animationFrameRequestId) {\n        cancelAnimationFrame(state.animationFrameRequestId);\n        state.animationFrameRequestId = null;\n      }\n\n      return this;\n    },\n    resumeAnimation: function resumeAnimation(state) {\n      if (!state.animationFrameRequestId) {\n        this._animationCycle();\n      }\n\n      return this;\n    },\n    _destructor: function _destructor() {\n      this.pauseAnimation();\n      this.graphData({\n        nodes: [],\n        links: []\n      });\n    }\n  }, linkedMethods),\n  stateInit: function stateInit() {\n    return {\n      lastSetZoom: 1,\n      zoom: zoom(),\n      forceGraph: new CanvasForceGraph(),\n      shadowGraph: new CanvasForceGraph().cooldownTicks(0).nodeColor('__indexColor').linkColor('__indexColor').isShadow(true),\n      colorTracker: new ColorTracker() // indexed objects for rgb lookup\n\n    };\n  },\n  init: function init(domNode, state) {\n    var _this = this; // Wipe DOM\n\n\n    domNode.innerHTML = ''; // Container anchor for canvas and tooltip\n\n    var container = document.createElement('div');\n    container.classList.add('force-graph-container');\n    container.style.position = 'relative';\n    domNode.appendChild(container);\n    state.canvas = document.createElement('canvas');\n    if (state.backgroundColor) state.canvas.style.background = state.backgroundColor;\n    container.appendChild(state.canvas);\n    state.shadowCanvas = document.createElement('canvas'); // Show shadow canvas\n    //state.shadowCanvas.style.position = 'absolute';\n    //state.shadowCanvas.style.top = '0';\n    //state.shadowCanvas.style.left = '0';\n    //container.appendChild(state.shadowCanvas);\n\n    var ctx = state.canvas.getContext('2d');\n    var shadowCtx = state.shadowCanvas.getContext('2d', {\n      willReadFrequently: true\n    });\n    var pointerPos = {\n      x: -1e12,\n      y: -1e12\n    };\n\n    var getObjUnderPointer = function getObjUnderPointer() {\n      var obj = null;\n      var pxScale = window.devicePixelRatio;\n      var px = pointerPos.x > 0 && pointerPos.y > 0 ? shadowCtx.getImageData(pointerPos.x * pxScale, pointerPos.y * pxScale, 1, 1) : null; // Lookup object per pixel color\n\n      px && (obj = state.colorTracker.lookup(px.data));\n      return obj;\n    }; // Setup node drag interaction\n\n\n    select(state.canvas).call(drag().subject(function () {\n      if (!state.enableNodeDrag) {\n        return null;\n      }\n\n      var obj = getObjUnderPointer();\n      return obj && obj.type === 'Node' ? obj.d : null; // Only drag nodes\n    }).on('start', function (ev) {\n      var obj = ev.subject;\n      obj.__initialDragPos = {\n        x: obj.x,\n        y: obj.y,\n        fx: obj.fx,\n        fy: obj.fy\n      }; // keep engine running at low intensity throughout drag\n\n      if (!ev.active) {\n        obj.fx = obj.x;\n        obj.fy = obj.y; // Fix points\n      } // drag cursor\n\n\n      state.canvas.classList.add('grabbable');\n    }).on('drag', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var dragPos = ev;\n      var k = zoomTransform(state.canvas).k;\n      var translate = {\n        x: initPos.x + (dragPos.x - initPos.x) / k - obj.x,\n        y: initPos.y + (dragPos.y - initPos.y) / k - obj.y\n      }; // Move fx/fy (and x/y) of nodes based on the scaled drag distance since the drag start\n\n      ['x', 'y'].forEach(function (c) {\n        return obj[\"f\".concat(c)] = obj[c] = initPos[c] + (dragPos[c] - initPos[c]) / k;\n      }); // prevent freeze while dragging\n\n      state.forceGraph.d3AlphaTarget(0.3) // keep engine running at low intensity throughout drag\n      .resetCountdown(); // prevent freeze while dragging\n\n      state.isPointerDragging = true;\n      obj.__dragged = true;\n      state.onNodeDrag(obj, translate);\n    }).on('end', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var translate = {\n        x: obj.x - initPos.x,\n        y: obj.y - initPos.y\n      };\n\n      if (initPos.fx === undefined) {\n        obj.fx = undefined;\n      }\n\n      if (initPos.fy === undefined) {\n        obj.fy = undefined;\n      }\n\n      delete obj.__initialDragPos;\n\n      if (state.forceGraph.d3AlphaTarget()) {\n        state.forceGraph.d3AlphaTarget(0) // release engine low intensity\n        .resetCountdown(); // let the engine readjust after releasing fixed nodes\n      } // drag cursor\n\n\n      state.canvas.classList.remove('grabbable');\n      state.isPointerDragging = false;\n\n      if (obj.__dragged) {\n        delete obj.__dragged;\n        state.onNodeDragEnd(obj, translate);\n      }\n    })); // Setup zoom / pan interaction\n\n    state.zoom(state.zoom.__baseElem = select(state.canvas)); // Attach controlling elem for easy access\n\n    state.zoom.__baseElem.on('dblclick.zoom', null); // Disable double-click to zoom\n\n\n    state.zoom.filter(function (ev) {\n      return (// disable zoom interaction\n        !ev.button && state.enableZoomPanInteraction && (state.enableZoomInteraction || ev.type !== 'wheel') && (state.enablePanInteraction || ev.type === 'wheel')\n      );\n    }).on('zoom', function (ev) {\n      var t = ev.transform;\n      [ctx, shadowCtx].forEach(function (c) {\n        resetTransform(c);\n        c.translate(t.x, t.y);\n        c.scale(t.k, t.k);\n      });\n      state.onZoom && state.onZoom(_objectSpread2(_objectSpread2({}, t), _this.centerAt())); // report x,y coordinates relative to canvas center\n\n      state.needsRedraw = true;\n    }).on('end', function (ev) {\n      return state.onZoomEnd && state.onZoomEnd(_objectSpread2(_objectSpread2({}, ev.transform), _this.centerAt()));\n    });\n    adjustCanvasSize(state);\n    state.forceGraph.onNeedsRedraw(function () {\n      return state.needsRedraw = true;\n    }).onFinishUpdate(function () {\n      // re-zoom, if still in default position (not user modified)\n      if (zoomTransform(state.canvas).k === state.lastSetZoom && state.graphData.nodes.length) {\n        state.zoom.scaleTo(state.zoom.__baseElem, state.lastSetZoom = ZOOM2NODES_FACTOR / Math.cbrt(state.graphData.nodes.length));\n        state.needsRedraw = true;\n      }\n    }); // Setup tooltip\n\n    var toolTipElem = document.createElement('div');\n    toolTipElem.classList.add('graph-tooltip');\n    container.appendChild(toolTipElem); // Capture pointer coords on move or touchstart\n\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return container.addEventListener(evType, function (ev) {\n        if (evType === 'pointerdown') {\n          state.isPointerPressed = true; // track click state\n\n          state.pointerDownEvent = ev;\n        } // detect pointer drag on canvas pan\n\n\n        !state.isPointerDragging && ev.type === 'pointermove' && state.onBackgroundClick // only bother detecting drags this way if background clicks are enabled (so they don't trigger accidentally on canvas panning)\n        && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we use the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true); // update the pointer pos\n\n        var offset = getOffset(container);\n        pointerPos.x = ev.pageX - offset.left;\n        pointerPos.y = ev.pageY - offset.top; // Move tooltip\n\n        toolTipElem.style.top = \"\".concat(pointerPos.y, \"px\");\n        toolTipElem.style.left = \"\".concat(pointerPos.x, \"px\"); // adjust horizontal position to not exceed canvas boundaries\n\n        toolTipElem.style.transform = \"translate(-\".concat(pointerPos.x / state.width * 100, \"%, \").concat( // flip to above if near bottom\n        state.height - pointerPos.y < 100 ? 'calc(-100% - 8px)' : '21px', \")\"); //\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n              scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n              scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    }); // Handle click/touch events on nodes/links\n\n    container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        return; // don't trigger click events after pointer drag (pan / node drag functionality)\n      }\n\n      var cbEvents = [ev, state.pointerDownEvent];\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // mouse left-click or touch\n          if (state.hoverObj) {\n            var fn = state[\"on\".concat(state.hoverObj.type, \"Click\")];\n            fn && fn.apply(void 0, [state.hoverObj.d].concat(cbEvents));\n          } else {\n            state.onBackgroundClick && state.onBackgroundClick.apply(state, cbEvents);\n          }\n        }\n\n        if (ev.button === 2) {\n          // mouse right-click\n          if (state.hoverObj) {\n            var _fn = state[\"on\".concat(state.hoverObj.type, \"RightClick\")];\n            _fn && _fn.apply(void 0, [state.hoverObj.d].concat(cbEvents));\n          } else {\n            state.onBackgroundRightClick && state.onBackgroundRightClick.apply(state, cbEvents);\n          }\n        }\n      });\n    }, {\n      passive: true\n    });\n    container.addEventListener('contextmenu', function (ev) {\n      if (!state.onBackgroundRightClick && !state.onNodeRightClick && !state.onLinkRightClick) return true; // default contextmenu behavior\n\n      ev.preventDefault();\n      return false;\n    });\n    state.forceGraph(ctx);\n    state.shadowGraph(shadowCtx); //\n\n    var refreshShadowCanvas = throttle(function () {\n      // wipe canvas\n      clearCanvas(shadowCtx, state.width, state.height); // Adjust link hover area\n\n      state.shadowGraph.linkWidth(function (l) {\n        return accessorFn(state.linkWidth)(l) + state.linkHoverPrecision;\n      }); // redraw\n\n      var t = zoomTransform(state.canvas);\n      state.shadowGraph.globalScale(t.k).tickFrame();\n    }, HOVER_CANVAS_THROTTLE_DELAY);\n    state.flushShadowCanvas = refreshShadowCanvas.flush; // hook to immediately invoke shadow canvas paint\n    // Kick-off renderer\n\n    (this._animationCycle = function animate() {\n      // IIFE\n      var doRedraw = !state.autoPauseRedraw || !!state.needsRedraw || state.forceGraph.isEngineRunning() || state.graphData.links.some(function (d) {\n        return d.__photons && d.__photons.length;\n      });\n      state.needsRedraw = false;\n\n      if (state.enablePointerInteraction) {\n        // Update tooltip and trigger onHover events\n        var obj = !state.isPointerDragging ? getObjUnderPointer() : null; // don't hover during drag\n\n        if (obj !== state.hoverObj) {\n          var prevObj = state.hoverObj;\n          var prevObjType = prevObj ? prevObj.type : null;\n          var objType = obj ? obj.type : null;\n\n          if (prevObjType && prevObjType !== objType) {\n            // Hover out\n            var fn = state[\"on\".concat(prevObjType, \"Hover\")];\n            fn && fn(null, prevObj.d);\n          }\n\n          if (objType) {\n            // Hover in\n            var _fn2 = state[\"on\".concat(objType, \"Hover\")];\n            _fn2 && _fn2(obj.d, prevObjType === objType ? prevObj.d : null);\n          }\n\n          var tooltipContent = obj ? accessorFn(state[\"\".concat(obj.type.toLowerCase(), \"Label\")])(obj.d) || '' : '';\n          toolTipElem.style.visibility = tooltipContent ? 'visible' : 'hidden';\n          toolTipElem.innerHTML = tooltipContent; // set pointer if hovered object is clickable\n\n          state.canvas.classList[obj && state[\"on\".concat(objType, \"Click\")] || !obj && state.onBackgroundClick ? 'add' : 'remove']('clickable');\n          state.hoverObj = obj;\n        }\n\n        doRedraw && refreshShadowCanvas();\n      }\n\n      if (doRedraw) {\n        // Wipe canvas\n        clearCanvas(ctx, state.width, state.height); // Frame cycle\n\n        var globalScale = zoomTransform(state.canvas).k;\n        state.onRenderFramePre && state.onRenderFramePre(ctx, globalScale);\n        state.forceGraph.globalScale(globalScale).tickFrame();\n        state.onRenderFramePost && state.onRenderFramePost(ctx, globalScale);\n      }\n\n      TWEEN.update(); // update canvas animation tweens\n\n      state.animationFrameRequestId = requestAnimationFrame(animate);\n    })();\n  },\n  update: function updateFn(state) {}\n});\nexport { forceGraph as default };","map":{"version":3,"sources":["/Users/samuelwright/Projects/portfolio/node_modules/force-graph/dist/force-graph.mjs"],"names":["select","zoom","zoomTransform","drag","min","max","throttle","TWEEN","Kapsule","accessorFn","ColorTracker","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","Bezier","indexBy","scaleOrdinal","schemePaired","styleInject","css","ref","insertAt","document","head","getElementsByTagName","style","createElement","type","firstChild","insertBefore","appendChild","styleSheet","cssText","createTextNode","css_248z","_iterableToArrayLimit","arr","i","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","return","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread2","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","constructor","prototype","_toPropertyKey","configurable","writable","_setPrototypeOf","o","p","setPrototypeOf","bind","__proto__","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","_construct","Parent","args","Class","a","Constructor","Function","instance","_slicedToArray","_arrayWithHoles","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","minLen","n","toString","slice","name","test","len","arr2","TypeError","_toPrimitive","input","hint","prim","toPrimitive","undefined","res","String","Number","arg","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","_ref","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","graph","node","data","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","map","_ref6","_ref7","id","nodeStack","currentDepth","_loop","indexOf","loop","d","some","foundLoop","every","idx","l","_ret","DAG_LEVEL_NODE_RATIO","notifyRedraw","_","state","onNeedsRedraw","updDataPhotons","isShadow","linkParticlesAccessor","linkDirectionalParticles","graphData","link","numPhotons","Math","round","abs","__photons","CanvasForceGraph","props","onChange","engineRunning","dagMode","fx","fy","dagLevelDistance","dagNodeFilter","_default","onDagError","triggerUpdate","nodeRelSize","nodeId","nodeVal","nodeColor","nodeAutoColorBy","nodeCanvasObject","nodeCanvasObjectMode","nodeVisibility","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkLineDash","linkWidth","linkCurvature","linkCanvasObject","linkCanvasObjectMode","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","globalScale","d3AlphaMin","d3AlphaDecay","alphaDecay","forceLayout","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","d3Force","forceName","forceFn","force","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","isEngineRunning","tickFrame","layoutTick","paintLinks","paintArrows","paintPhotons","paintNodes","tick","getVisibility","getVal","getColor","getNodeCanvasObjectMode","ctx","padAmount","visibleNodes","save","restore","r","sqrt","beginPath","arc","x","y","PI","fillStyle","fill","getWidth","getLineDash","getCurvature","getLinkCanvasObjectMode","visibleLinks","calcLinkControlPoints","beforeCustomLinks","afterCustomLinks","defaultPaintLinks","replaceCustomLinks","otherCustomLinks","before","after","replace","linksPerColor","color","linksPerWidth","lineColor","width","linesPerLineDash","lineWidth","lineDashSegments","start","end","moveTo","controlPoints","__controlPoints","lineTo","strokeStyle","setLineDash","stroke","curvature","pow","atan2","cp","cos","sin","ARROW_WH_RATIO","ARROW_VLEN_RATIO","getLength","getRelPos","getNodeVal","arrowLength","startR","endR","arrowRelPos","arrowColor","arrowHalfWidth","bzLine","getCoordsAlongLine","t","get","lineLen","posAlongLine","arrowHead","arrowTail","arrowTailVertex","arrowTailAngle","getNumPhotons","getSpeed","getDiameter","numCyclePhotons","particleSpeed","photons","photonR","photonColor","cyclePhotonIdx","needsCleanup","photon","singleHop","__singleHop","__progressRatio","photonPosRatio","coords","emitParticle","stateInit","stop","init","canvasCtx","update","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","nodeDepth","strength","linkKapsule","kapsulePropNames","kapsuleType","propNames","dummyK","linkProp","prop","v","propName","linkMethod","method","_len","_key","returnVals","kapsuleInstance","returnVal","HOVER_CANVAS_THROTTLE_DELAY","ZOOM2NODES_FACTOR","bindFG","bindBoth","linkedProps","linkedMethods","adjustCanvasSize","canvas","curWidth","curHeight","height","pxScale","window","devicePixelRatio","shadowCanvas","getContext","scale","k","translateBy","__baseElem","needsRedraw","resetTransform","pxRatio","setTransform","clearCanvas","clearRect","forceGraph","innerWidth","innerHeight","objs","hexIndex","shadowGraph","cur","colorTracker","lookup","__indexColor","register","backgroundColor","background","nodeLabel","nodePointerAreaPaint","paintFn","flushShadowCanvas","linkPointerAreaPaint","linkLabel","linkHoverPrecision","minZoom","scaleExtent","maxZoom","enableNodeDrag","enableZoomInteraction","enablePanInteraction","enableZoomPanInteraction","enablePointerInteraction","hoverObj","autoPauseRedraw","onNodeDrag","onNodeDragEnd","onNodeClick","onNodeRightClick","onNodeHover","onLinkClick","onLinkRightClick","onLinkHover","onBackgroundClick","onBackgroundRightClick","onZoom","onZoomEnd","onRenderFramePre","onRenderFramePost","aliases","stopAnimation","graph2ScreenCoords","screen2GraphCoords","centerAt","transitionDuration","finalPos","setCenter","Tween","getCenter","to","easing","Easing","Quadratic","Out","translateTo","setZoom","getZoom","scaleTo","zoomToFit","padding","bboxArgs","bbox","getGraphBbox","center","zoomK","getR","nodesPos","pauseAnimation","animationFrameRequestId","cancelAnimationFrame","resumeAnimation","_animationCycle","_destructor","lastSetZoom","domNode","_this","innerHTML","container","classList","add","position","shadowCtx","willReadFrequently","pointerPos","getObjUnderPointer","px","getImageData","subject","on","ev","__initialDragPos","active","initPos","dragPos","translate","c","isPointerDragging","__dragged","remove","button","transform","cbrt","toolTipElem","evType","addEventListener","isPointerPressed","pointerDownEvent","pressure","pointerType","movementX","movementY","m","offset","getOffset","pageX","left","pageY","top","el","rect","getBoundingClientRect","scrollLeft","pageXOffset","documentElement","scrollTop","pageYOffset","passive","cbEvents","requestAnimationFrame","fn","_fn","preventDefault","refreshShadowCanvas","flush","animate","doRedraw","prevObj","prevObjType","objType","_fn2","tooltipContent","toLowerCase","visibility","updateFn","default"],"mappings":"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","sourcesContent":["import { select } from 'd3-selection';\nimport { zoom, zoomTransform } from 'd3-zoom';\nimport { drag } from 'd3-drag';\nimport { min, max } from 'd3-array';\nimport { throttle } from 'lodash-es';\nimport TWEEN from '@tweenjs/tween.js';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport ColorTracker from 'canvas-color-tracker';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport { Bezier } from 'bezier-js';\nimport indexBy from 'index-array-by';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".force-graph-container canvas {\\n  display: block;\\n  user-select: none;\\n  outline: none;\\n  -webkit-tap-highlight-color: transparent;\\n}\\n\\n.force-graph-container .graph-tooltip {\\n  position: absolute;\\n  top: 0;\\n  font-family: sans-serif;\\n  font-size: 16px;\\n  padding: 4px;\\n  border-radius: 3px;\\n  color: #eee;\\n  background: rgba(0,0,0,0.65);\\n  visibility: hidden; /* by default */\\n}\\n\\n.force-graph-container .clickable {\\n  cursor: pointer;\\n}\\n\\n.force-graph-container .grabbable {\\n  cursor: move;\\n  cursor: grab;\\n  cursor: -moz-grab;\\n  cursor: -webkit-grab;\\n}\\n\\n.force-graph-container .grabbable:active {\\n  cursor: grabbing;\\n  cursor: -moz-grabbing;\\n  cursor: -webkit-grabbing;\\n}\\n\";\nstyleInject(css_248z);\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n  return _construct.apply(null, arguments);\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return \"continue\";\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n      if (_ret === \"continue\") continue;\n    }\n  }\n}\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// whenever styling props are changed that require a canvas redraw\nvar notifyRedraw = function notifyRedraw(_, state) {\n  return state.onNeedsRedraw && state.onNeedsRedraw();\n};\nvar updDataPhotons = function updDataPhotons(_, state) {\n  if (!state.isShadow) {\n    // Add photon particles\n    var linkParticlesAccessor = accessorFn(state.linkDirectionalParticles);\n    state.graphData.links.forEach(function (link) {\n      var numPhotons = Math.round(Math.abs(linkParticlesAccessor(link)));\n      if (numPhotons) {\n        link.__photons = _toConsumableArray(Array(numPhotons)).map(function () {\n          return {};\n        });\n      } else {\n        delete link.__photons;\n      }\n    });\n  }\n};\nvar CanvasForceGraph = Kapsule({\n  props: {\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(_, state) {\n        state.engineRunning = false; // Pause simulation\n        updDataPhotons(_, state);\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, radialin, radialout\n        !dagMode && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    // area per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeColor: {\n      \"default\": 'color',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeAutoColorBy: {},\n    nodeCanvasObject: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    nodeVisibility: {\n      \"default\": true,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkColor: {\n      \"default\": 'color',\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkAutoColorBy: {},\n    linkLineDash: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkWidth: {\n      \"default\": 1,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCanvasObject: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkCanvasObjectMode: {\n      \"default\": function _default() {\n        return 'replace';\n      },\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowLength: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowColor: {\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false,\n      onChange: notifyRedraw\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalParticles: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: updDataPhotons\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    linkDirectionalParticleColor: {\n      triggerUpdate: false\n    },\n    globalScale: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    d3AlphaMin: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.forceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.forceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.forceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNeedsRedraw: {\n      triggerUpdate: false\n    },\n    isShadow: {\n      \"default\": false,\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.forceLayout.force(forceName); // Force getter\n      }\n\n      state.forceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.forceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    isEngineRunning: function isEngineRunning(state) {\n      return !!state.engineRunning;\n    },\n    tickFrame: function tickFrame(state) {\n      !state.isShadow && layoutTick();\n      paintLinks();\n      !state.isShadow && paintArrows();\n      !state.isShadow && paintPhotons();\n      paintNodes();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (state.engineRunning) {\n          if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin) {\n            state.engineRunning = false; // Stop ticking graph\n            state.onEngineStop();\n          } else {\n            state.forceLayout.tick(); // Tick it\n            state.onEngineTick();\n          }\n        }\n      }\n      function paintNodes() {\n        var getVisibility = accessorFn(state.nodeVisibility);\n        var getVal = accessorFn(state.nodeVal);\n        var getColor = accessorFn(state.nodeColor);\n        var getNodeCanvasObjectMode = accessorFn(state.nodeCanvasObjectMode);\n        var ctx = state.ctx;\n\n        // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n        var padAmount = state.isShadow / state.globalScale;\n        var visibleNodes = state.graphData.nodes.filter(getVisibility);\n        ctx.save();\n        visibleNodes.forEach(function (node) {\n          var nodeCanvasObjectMode = getNodeCanvasObjectMode(node);\n          if (state.nodeCanvasObject && (nodeCanvasObjectMode === 'before' || nodeCanvasObjectMode === 'replace')) {\n            // Custom node before/replace paint\n            state.nodeCanvasObject(node, ctx, state.globalScale);\n            if (nodeCanvasObjectMode === 'replace') {\n              ctx.restore();\n              return;\n            }\n          }\n\n          // Draw wider nodes by 1px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n          var r = Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize + padAmount;\n          ctx.beginPath();\n          ctx.arc(node.x, node.y, r, 0, 2 * Math.PI, false);\n          ctx.fillStyle = getColor(node) || 'rgba(31, 120, 180, 0.92)';\n          ctx.fill();\n          if (state.nodeCanvasObject && nodeCanvasObjectMode === 'after') {\n            // Custom node after paint\n            state.nodeCanvasObject(node, state.ctx, state.globalScale);\n          }\n        });\n        ctx.restore();\n      }\n      function paintLinks() {\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkColor);\n        var getWidth = accessorFn(state.linkWidth);\n        var getLineDash = accessorFn(state.linkLineDash);\n        var getCurvature = accessorFn(state.linkCurvature);\n        var getLinkCanvasObjectMode = accessorFn(state.linkCanvasObjectMode);\n        var ctx = state.ctx;\n\n        // Draw wider lines by 2px on shadow canvas for more precise hovering (due to boundary anti-aliasing)\n        var padAmount = state.isShadow * 2;\n        var visibleLinks = state.graphData.links.filter(getVisibility);\n        visibleLinks.forEach(calcLinkControlPoints); // calculate curvature control points for all visible links\n\n        var beforeCustomLinks = [],\n          afterCustomLinks = [],\n          defaultPaintLinks = visibleLinks;\n        if (state.linkCanvasObject) {\n          var replaceCustomLinks = [],\n            otherCustomLinks = [];\n          visibleLinks.forEach(function (d) {\n            return ({\n              before: beforeCustomLinks,\n              after: afterCustomLinks,\n              replace: replaceCustomLinks\n            }[getLinkCanvasObjectMode(d)] || otherCustomLinks).push(d);\n          });\n          defaultPaintLinks = [].concat(_toConsumableArray(beforeCustomLinks), afterCustomLinks, otherCustomLinks);\n          beforeCustomLinks = beforeCustomLinks.concat(replaceCustomLinks);\n        }\n\n        // Custom link before paints\n        ctx.save();\n        beforeCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore();\n\n        // Bundle strokes per unique color/width/dash for performance optimization\n        var linksPerColor = indexBy(defaultPaintLinks, [getColor, getWidth, getLineDash]);\n        ctx.save();\n        Object.entries(linksPerColor).forEach(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            color = _ref2[0],\n            linksPerWidth = _ref2[1];\n          var lineColor = !color || color === 'undefined' ? 'rgba(0,0,0,0.15)' : color;\n          Object.entries(linksPerWidth).forEach(function (_ref3) {\n            var _ref4 = _slicedToArray(_ref3, 2),\n              width = _ref4[0],\n              linesPerLineDash = _ref4[1];\n            var lineWidth = (width || 1) / state.globalScale + padAmount;\n            Object.entries(linesPerLineDash).forEach(function (_ref5) {\n              var _ref6 = _slicedToArray(_ref5, 2);\n                _ref6[0];\n                var links = _ref6[1];\n              var lineDashSegments = getLineDash(links[0]);\n              ctx.beginPath();\n              links.forEach(function (link) {\n                var start = link.source;\n                var end = link.target;\n                if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n                ctx.moveTo(start.x, start.y);\n                var controlPoints = link.__controlPoints;\n                if (!controlPoints) {\n                  // Straight line\n                  ctx.lineTo(end.x, end.y);\n                } else {\n                  // Use quadratic curves for regular lines and bezier for loops\n                  ctx[controlPoints.length === 2 ? 'quadraticCurveTo' : 'bezierCurveTo'].apply(ctx, _toConsumableArray(controlPoints).concat([end.x, end.y]));\n                }\n              });\n              ctx.strokeStyle = lineColor;\n              ctx.lineWidth = lineWidth;\n              ctx.setLineDash(lineDashSegments || []);\n              ctx.stroke();\n            });\n          });\n        });\n        ctx.restore();\n\n        // Custom link after paints\n        ctx.save();\n        afterCustomLinks.forEach(function (link) {\n          return state.linkCanvasObject(link, ctx, state.globalScale);\n        });\n        ctx.restore();\n\n        //\n\n        function calcLinkControlPoints(link) {\n          var curvature = getCurvature(link);\n          if (!curvature) {\n            // straight line\n            link.__controlPoints = null;\n            return;\n          }\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var l = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2)); // line length\n\n          if (l > 0) {\n            var a = Math.atan2(end.y - start.y, end.x - start.x); // line angle\n            var d = l * curvature; // control point distance\n\n            var cp = {\n              // control point\n              x: (start.x + end.x) / 2 + d * Math.cos(a - Math.PI / 2),\n              y: (start.y + end.y) / 2 + d * Math.sin(a - Math.PI / 2)\n            };\n            link.__controlPoints = [cp.x, cp.y];\n          } else {\n            // Same point, draw a loop\n            var _d = curvature * 70;\n            link.__controlPoints = [end.x, end.y - _d, end.x + _d, end.y];\n          }\n        }\n      }\n      function paintArrows() {\n        var ARROW_WH_RATIO = 1.6;\n        var ARROW_VLEN_RATIO = 0.2;\n        var getLength = accessorFn(state.linkDirectionalArrowLength);\n        var getRelPos = accessorFn(state.linkDirectionalArrowRelPos);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalArrowColor || state.linkColor);\n        var getNodeVal = accessorFn(state.nodeVal);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var arrowLength = getLength(link);\n          if (!arrowLength || arrowLength < 0) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.sqrt(Math.max(0, getNodeVal(start) || 1)) * state.nodeRelSize;\n          var endR = Math.sqrt(Math.max(0, getNodeVal(end) || 1)) * state.nodeRelSize;\n          var arrowRelPos = Math.min(1, Math.max(0, getRelPos(link)));\n          var arrowColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          var arrowHalfWidth = arrowLength / ARROW_WH_RATIO / 2;\n\n          // Construct bezier for curved lines\n          var bzLine = link.__controlPoints && _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y]));\n          var getCoordsAlongLine = bzLine ? function (t) {\n            return bzLine.get(t);\n          } // get position along bezier line\n          : function (t) {\n            return {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * t || 0,\n              y: start.y + (end.y - start.y) * t || 0\n            };\n          };\n          var lineLen = bzLine ? bzLine.length() : Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getCoordsAlongLine(posAlongLine / lineLen);\n          var arrowTail = getCoordsAlongLine((posAlongLine - arrowLength) / lineLen);\n          var arrowTailVertex = getCoordsAlongLine((posAlongLine - arrowLength * (1 - ARROW_VLEN_RATIO)) / lineLen);\n          var arrowTailAngle = Math.atan2(arrowHead.y - arrowTail.y, arrowHead.x - arrowTail.x) - Math.PI / 2;\n          ctx.beginPath();\n          ctx.moveTo(arrowHead.x, arrowHead.y);\n          ctx.lineTo(arrowTail.x + arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y + arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.lineTo(arrowTailVertex.x, arrowTailVertex.y);\n          ctx.lineTo(arrowTail.x - arrowHalfWidth * Math.cos(arrowTailAngle), arrowTail.y - arrowHalfWidth * Math.sin(arrowTailAngle));\n          ctx.fillStyle = arrowColor;\n          ctx.fill();\n        });\n        ctx.restore();\n      }\n      function paintPhotons() {\n        var getNumPhotons = accessorFn(state.linkDirectionalParticles);\n        var getSpeed = accessorFn(state.linkDirectionalParticleSpeed);\n        var getDiameter = accessorFn(state.linkDirectionalParticleWidth);\n        var getVisibility = accessorFn(state.linkVisibility);\n        var getColor = accessorFn(state.linkDirectionalParticleColor || state.linkColor);\n        var ctx = state.ctx;\n        ctx.save();\n        state.graphData.links.filter(getVisibility).forEach(function (link) {\n          var numCyclePhotons = getNumPhotons(link);\n          if (!link.hasOwnProperty('__photons') || !link.__photons.length) return;\n          var start = link.source;\n          var end = link.target;\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = getSpeed(link);\n          var photons = link.__photons || [];\n          var photonR = Math.max(0, getDiameter(link) / 2) / Math.sqrt(state.globalScale);\n          var photonColor = getColor(link) || 'rgba(0,0,0,0.28)';\n          ctx.fillStyle = photonColor;\n\n          // Construct bezier for curved lines\n          var bzLine = link.__controlPoints ? _construct(Bezier, [start.x, start.y].concat(_toConsumableArray(link.__controlPoints), [end.x, end.y])) : null;\n          var cyclePhotonIdx = 0;\n          var needsCleanup = false; // whether some photons need to be removed from list\n          photons.forEach(function (photon) {\n            var singleHop = !!photon.__singleHop;\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : cyclePhotonIdx / numCyclePhotons;\n            }\n            !singleHop && cyclePhotonIdx++; // increase regular photon index\n\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                needsCleanup = true;\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var coords = bzLine ? bzLine.get(photonPosRatio) // get position along bezier line\n            : {\n              // straight line: interpolate linearly\n              x: start.x + (end.x - start.x) * photonPosRatio || 0,\n              y: start.y + (end.y - start.y) * photonPosRatio || 0\n            };\n            ctx.beginPath();\n            ctx.arc(coords.x, coords.y, photonR, 0, 2 * Math.PI, false);\n            ctx.fill();\n          });\n          if (needsCleanup) {\n            // remove expired single hop photons\n            link.__photons = link.__photons.filter(function (photon) {\n              return !photon.__singleHop || photon.__progressRatio <= 1;\n            });\n          }\n        });\n        ctx.restore();\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link) {\n        !link.__photons && (link.__photons = []);\n        link.__photons.push({\n          __singleHop: true\n        }); // add a single hop particle\n      }\n\n      return this;\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      forceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(canvasCtx, state) {\n    // Main canvas object to manipulate\n    state.ctx = canvasCtx;\n  },\n  update: function update(state) {\n    state.engineRunning = false; // Pause simulation\n    state.onUpdate();\n    if (state.nodeAutoColorBy !== null) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // parse links\n    state.graphData.links.forEach(function (link) {\n      link.source = link[state.linkSource];\n      link.target = link[state.linkTarget];\n    });\n\n    // Feed data to force-directed layout\n    state.forceLayout.stop().alpha(1) // re-heat the simulation\n    .nodes(state.graphData.nodes);\n\n    // add links (if link force is still active)\n    var linkForce = state.forceLayout.force('link');\n    if (linkForce) {\n      linkForce.id(function (d) {\n        return d[state.nodeId];\n      }).links(state.graphData.links);\n    }\n\n    // setup dag force constraints\n    var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n      return node[state.nodeId];\n    }, {\n      nodeFilter: state.dagNodeFilter,\n      onLoopError: state.onDagError || undefined\n    });\n    var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n    var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n    // Fix nodes to x,y for dag mode\n    if (state.dagMode) {\n      var getFFn = function getFFn(fix, invert) {\n        return function (node) {\n          return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n        };\n      };\n      var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n      var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'bu');\n      state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n        node.fx = fxFn(node);\n        node.fy = fyFn(node);\n      });\n    }\n\n    // Use radial force for radial dags\n    state.forceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n      var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n      return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n    }).strength(function (node) {\n      return state.dagNodeFilter(node) ? 1 : 0;\n    }) : null);\n    for (var i = 0; i < state.warmupTicks && !(state.d3AlphaMin > 0 && state.forceLayout.alpha() < state.d3AlphaMin); i++) {\n      state.forceLayout.tick();\n    } // Initial ticks before starting to render\n\n    this.resetCountdown();\n    state.onFinishUpdate();\n  }\n});\n\nfunction linkKapsule (kapsulePropNames, kapsuleType) {\n  var propNames = kapsulePropNames instanceof Array ? kapsulePropNames : [kapsulePropNames];\n  var dummyK = new kapsuleType(); // To extract defaults\n\n  return {\n    linkProp: function linkProp(prop) {\n      // link property config\n      return {\n        \"default\": dummyK[prop](),\n        onChange: function onChange(v, state) {\n          propNames.forEach(function (propName) {\n            return state[propName][prop](v);\n          });\n        },\n        triggerUpdate: false\n      };\n    },\n    linkMethod: function linkMethod(method) {\n      // link method pass-through\n      return function (state) {\n        for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n          args[_key - 1] = arguments[_key];\n        }\n        var returnVals = [];\n        propNames.forEach(function (propName) {\n          var kapsuleInstance = state[propName];\n          var returnVal = kapsuleInstance[method].apply(kapsuleInstance, args);\n          if (returnVal !== kapsuleInstance) {\n            returnVals.push(returnVal);\n          }\n        });\n        return returnVals.length ? returnVals[0] : this; // chain based on the parent object, not the inner kapsule\n      };\n    }\n  };\n}\n\nvar HOVER_CANVAS_THROTTLE_DELAY = 800; // ms to throttle shadow canvas updates for perf improvement\nvar ZOOM2NODES_FACTOR = 4;\n\n// Expose config from forceGraph\nvar bindFG = linkKapsule('forceGraph', CanvasForceGraph);\nvar bindBoth = linkKapsule(['forceGraph', 'shadowGraph'], CanvasForceGraph);\nvar linkedProps = Object.assign.apply(Object, _toConsumableArray(['nodeColor', 'nodeAutoColorBy', 'nodeCanvasObject', 'nodeCanvasObjectMode', 'linkColor', 'linkAutoColorBy', 'linkLineDash', 'linkWidth', 'linkCanvasObject', 'linkCanvasObjectMode', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowRelPos', 'linkDirectionalParticles', 'linkDirectionalParticleSpeed', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'dagMode', 'dagLevelDistance', 'dagNodeFilter', 'onDagError', 'd3AlphaMin', 'd3AlphaDecay', 'd3VelocityDecay', 'warmupTicks', 'cooldownTicks', 'cooldownTime', 'onEngineTick', 'onEngineStop'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkProp(p));\n})).concat(_toConsumableArray(['nodeRelSize', 'nodeId', 'nodeVal', 'nodeVisibility', 'linkSource', 'linkTarget', 'linkVisibility', 'linkCurvature'].map(function (p) {\n  return _defineProperty({}, p, bindBoth.linkProp(p));\n}))));\nvar linkedMethods = Object.assign.apply(Object, _toConsumableArray(['d3Force', 'd3ReheatSimulation', 'emitParticle'].map(function (p) {\n  return _defineProperty({}, p, bindFG.linkMethod(p));\n})));\nfunction adjustCanvasSize(state) {\n  if (state.canvas) {\n    var curWidth = state.canvas.width;\n    var curHeight = state.canvas.height;\n    if (curWidth === 300 && curHeight === 150) {\n      // Default canvas dimensions\n      curWidth = curHeight = 0;\n    }\n    var pxScale = window.devicePixelRatio; // 2 on retina displays\n    curWidth /= pxScale;\n    curHeight /= pxScale;\n\n    // Resize canvases\n    [state.canvas, state.shadowCanvas].forEach(function (canvas) {\n      // Element size\n      canvas.style.width = \"\".concat(state.width, \"px\");\n      canvas.style.height = \"\".concat(state.height, \"px\");\n\n      // Memory size (scaled to avoid blurriness)\n      canvas.width = state.width * pxScale;\n      canvas.height = state.height * pxScale;\n\n      // Normalize coordinate system to use css pixels (on init only)\n      if (!curWidth && !curHeight) {\n        canvas.getContext('2d').scale(pxScale, pxScale);\n      }\n    });\n\n    // Relative center panning based on 0,0\n    var k = zoomTransform(state.canvas).k;\n    state.zoom.translateBy(state.zoom.__baseElem, (state.width - curWidth) / 2 / k, (state.height - curHeight) / 2 / k);\n    state.needsRedraw = true;\n  }\n}\nfunction resetTransform(ctx) {\n  var pxRatio = window.devicePixelRatio;\n  ctx.setTransform(pxRatio, 0, 0, pxRatio, 0, 0);\n}\nfunction clearCanvas(ctx, width, height) {\n  ctx.save();\n  resetTransform(ctx); // reset transform\n  ctx.clearRect(0, 0, width, height);\n  ctx.restore(); //restore transforms\n}\n\n//\n\nvar forceGraph = Kapsule({\n  props: _objectSpread2({\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(_, state) {\n        return adjustCanvasSize(state);\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(d, state) {\n        [{\n          type: 'Node',\n          objs: d.nodes\n        }, {\n          type: 'Link',\n          objs: d.links\n        }].forEach(hexIndex);\n        state.forceGraph.graphData(d);\n        state.shadowGraph.graphData(d);\n        function hexIndex(_ref4) {\n          var type = _ref4.type,\n            objs = _ref4.objs;\n          objs.filter(function (d) {\n            if (!d.hasOwnProperty('__indexColor')) return true;\n            var cur = state.colorTracker.lookup(d.__indexColor);\n            return !cur || !cur.hasOwnProperty('d') || cur.d !== d;\n          }).forEach(function (d) {\n            // store object lookup color\n            d.__indexColor = state.colorTracker.register({\n              type: type,\n              d: d\n            });\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    backgroundColor: {\n      onChange: function onChange(color, state) {\n        state.canvas && color && (state.canvas.style.background = color);\n      },\n      triggerUpdate: false\n    },\n    nodeLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    nodePointerAreaPaint: {\n      onChange: function onChange(paintFn, state) {\n        state.shadowGraph.nodeCanvasObject(!paintFn ? null : function (node, ctx, globalScale) {\n          return paintFn(node, node.__indexColor, ctx, globalScale);\n        });\n        state.flushShadowCanvas && state.flushShadowCanvas();\n      },\n      triggerUpdate: false\n    },\n    linkPointerAreaPaint: {\n      onChange: function onChange(paintFn, state) {\n        state.shadowGraph.linkCanvasObject(!paintFn ? null : function (link, ctx, globalScale) {\n          return paintFn(link, link.__indexColor, ctx, globalScale);\n        });\n        state.flushShadowCanvas && state.flushShadowCanvas();\n      },\n      triggerUpdate: false\n    },\n    linkLabel: {\n      \"default\": 'name',\n      triggerUpdate: false\n    },\n    linkHoverPrecision: {\n      \"default\": 4,\n      triggerUpdate: false\n    },\n    minZoom: {\n      \"default\": 0.01,\n      onChange: function onChange(minZoom, state) {\n        state.zoom.scaleExtent([minZoom, state.zoom.scaleExtent()[1]]);\n      },\n      triggerUpdate: false\n    },\n    maxZoom: {\n      \"default\": 1000,\n      onChange: function onChange(maxZoom, state) {\n        state.zoom.scaleExtent([state.zoom.scaleExtent()[0], maxZoom]);\n      },\n      triggerUpdate: false\n    },\n    enableNodeDrag: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enablePanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    enableZoomPanInteraction: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    // to be deprecated\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        state.hoverObj = null;\n      },\n      triggerUpdate: false\n    },\n    autoPauseRedraw: {\n      \"default\": true,\n      triggerUpdate: false\n    },\n    onNodeDrag: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeDragEnd: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onNodeClick: {\n      triggerUpdate: false\n    },\n    onNodeRightClick: {\n      triggerUpdate: false\n    },\n    onNodeHover: {\n      triggerUpdate: false\n    },\n    onLinkClick: {\n      triggerUpdate: false\n    },\n    onLinkRightClick: {\n      triggerUpdate: false\n    },\n    onLinkHover: {\n      triggerUpdate: false\n    },\n    onBackgroundClick: {\n      triggerUpdate: false\n    },\n    onBackgroundRightClick: {\n      triggerUpdate: false\n    },\n    onZoom: {\n      triggerUpdate: false\n    },\n    onZoomEnd: {\n      triggerUpdate: false\n    },\n    onRenderFramePre: {\n      triggerUpdate: false\n    },\n    onRenderFramePost: {\n      triggerUpdate: false\n    }\n  }, linkedProps),\n  aliases: {\n    // Prop names supported for backwards compatibility\n    stopAnimation: 'pauseAnimation'\n  },\n  methods: _objectSpread2({\n    graph2ScreenCoords: function graph2ScreenCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: x * t.k + t.x,\n        y: y * t.k + t.y\n      };\n    },\n    screen2GraphCoords: function screen2GraphCoords(state, x, y) {\n      var t = zoomTransform(state.canvas);\n      return {\n        x: (x - t.x) / t.k,\n        y: (y - t.y) / t.k\n      };\n    },\n    centerAt: function centerAt(state, x, y, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n\n      // setter\n      if (x !== undefined || y !== undefined) {\n        var finalPos = Object.assign({}, x !== undefined ? {\n          x: x\n        } : {}, y !== undefined ? {\n          y: y\n        } : {});\n        if (!transitionDuration) {\n          // no animation\n          setCenter(finalPos);\n        } else {\n          new TWEEN.Tween(getCenter()).to(finalPos, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(setCenter).start();\n        }\n        return this;\n      }\n\n      // getter\n      return getCenter();\n\n      //\n\n      function getCenter() {\n        var t = zoomTransform(state.canvas);\n        return {\n          x: (state.width / 2 - t.x) / t.k,\n          y: (state.height / 2 - t.y) / t.k\n        };\n      }\n      function setCenter(_ref5) {\n        var x = _ref5.x,\n          y = _ref5.y;\n        state.zoom.translateTo(state.zoom.__baseElem, x === undefined ? getCenter().x : x, y === undefined ? getCenter().y : y);\n        state.needsRedraw = true;\n      }\n    },\n    zoom: function zoom(state, k, transitionDuration) {\n      if (!state.canvas) return null; // no canvas yet\n\n      // setter\n      if (k !== undefined) {\n        if (!transitionDuration) {\n          // no animation\n          setZoom(k);\n        } else {\n          new TWEEN.Tween({\n            k: getZoom()\n          }).to({\n            k: k\n          }, transitionDuration).easing(TWEEN.Easing.Quadratic.Out).onUpdate(function (_ref6) {\n            var k = _ref6.k;\n            return setZoom(k);\n          }).start();\n        }\n        return this;\n      }\n\n      // getter\n      return getZoom();\n\n      //\n\n      function getZoom() {\n        return zoomTransform(state.canvas).k;\n      }\n      function setZoom(k) {\n        state.zoom.scaleTo(state.zoom.__baseElem, k);\n        state.needsRedraw = true;\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n      var bbox = this.getGraphBbox.apply(this, bboxArgs);\n      if (bbox) {\n        var center = {\n          x: (bbox.x[0] + bbox.x[1]) / 2,\n          y: (bbox.y[0] + bbox.y[1]) / 2\n        };\n        var zoomK = Math.max(1e-12, Math.min(1e12, (state.width - padding * 2) / (bbox.x[1] - bbox.x[0]), (state.height - padding * 2) / (bbox.y[1] - bbox.y[0])));\n        this.centerAt(center.x, center.y, transitionDuration);\n        this.zoom(zoomK, transitionDuration);\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var getVal = accessorFn(state.nodeVal);\n      var getR = function getR(node) {\n        return Math.sqrt(Math.max(0, getVal(node) || 1)) * state.nodeRelSize;\n      };\n      var nodesPos = state.graphData.nodes.filter(nodeFilter).map(function (node) {\n        return {\n          x: node.x,\n          y: node.y,\n          r: getR(node)\n        };\n      });\n      return !nodesPos.length ? null : {\n        x: [min(nodesPos, function (node) {\n          return node.x - node.r;\n        }), max(nodesPos, function (node) {\n          return node.x + node.r;\n        })],\n        y: [min(nodesPos, function (node) {\n          return node.y - node.r;\n        }), max(nodesPos, function (node) {\n          return node.y + node.r;\n        })]\n      };\n    },\n    pauseAnimation: function pauseAnimation(state) {\n      if (state.animationFrameRequestId) {\n        cancelAnimationFrame(state.animationFrameRequestId);\n        state.animationFrameRequestId = null;\n      }\n      return this;\n    },\n    resumeAnimation: function resumeAnimation(state) {\n      if (!state.animationFrameRequestId) {\n        this._animationCycle();\n      }\n      return this;\n    },\n    _destructor: function _destructor() {\n      this.pauseAnimation();\n      this.graphData({\n        nodes: [],\n        links: []\n      });\n    }\n  }, linkedMethods),\n  stateInit: function stateInit() {\n    return {\n      lastSetZoom: 1,\n      zoom: zoom(),\n      forceGraph: new CanvasForceGraph(),\n      shadowGraph: new CanvasForceGraph().cooldownTicks(0).nodeColor('__indexColor').linkColor('__indexColor').isShadow(true),\n      colorTracker: new ColorTracker() // indexed objects for rgb lookup\n    };\n  },\n\n  init: function init(domNode, state) {\n    var _this = this;\n    // Wipe DOM\n    domNode.innerHTML = '';\n\n    // Container anchor for canvas and tooltip\n    var container = document.createElement('div');\n    container.classList.add('force-graph-container');\n    container.style.position = 'relative';\n    domNode.appendChild(container);\n    state.canvas = document.createElement('canvas');\n    if (state.backgroundColor) state.canvas.style.background = state.backgroundColor;\n    container.appendChild(state.canvas);\n    state.shadowCanvas = document.createElement('canvas');\n\n    // Show shadow canvas\n    //state.shadowCanvas.style.position = 'absolute';\n    //state.shadowCanvas.style.top = '0';\n    //state.shadowCanvas.style.left = '0';\n    //container.appendChild(state.shadowCanvas);\n\n    var ctx = state.canvas.getContext('2d');\n    var shadowCtx = state.shadowCanvas.getContext('2d', {\n      willReadFrequently: true\n    });\n    var pointerPos = {\n      x: -1e12,\n      y: -1e12\n    };\n    var getObjUnderPointer = function getObjUnderPointer() {\n      var obj = null;\n      var pxScale = window.devicePixelRatio;\n      var px = pointerPos.x > 0 && pointerPos.y > 0 ? shadowCtx.getImageData(pointerPos.x * pxScale, pointerPos.y * pxScale, 1, 1) : null;\n      // Lookup object per pixel color\n      px && (obj = state.colorTracker.lookup(px.data));\n      return obj;\n    };\n\n    // Setup node drag interaction\n    select(state.canvas).call(drag().subject(function () {\n      if (!state.enableNodeDrag) {\n        return null;\n      }\n      var obj = getObjUnderPointer();\n      return obj && obj.type === 'Node' ? obj.d : null; // Only drag nodes\n    }).on('start', function (ev) {\n      var obj = ev.subject;\n      obj.__initialDragPos = {\n        x: obj.x,\n        y: obj.y,\n        fx: obj.fx,\n        fy: obj.fy\n      };\n\n      // keep engine running at low intensity throughout drag\n      if (!ev.active) {\n        obj.fx = obj.x;\n        obj.fy = obj.y; // Fix points\n      }\n\n      // drag cursor\n      state.canvas.classList.add('grabbable');\n    }).on('drag', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var dragPos = ev;\n      var k = zoomTransform(state.canvas).k;\n      var translate = {\n        x: initPos.x + (dragPos.x - initPos.x) / k - obj.x,\n        y: initPos.y + (dragPos.y - initPos.y) / k - obj.y\n      };\n\n      // Move fx/fy (and x/y) of nodes based on the scaled drag distance since the drag start\n      ['x', 'y'].forEach(function (c) {\n        return obj[\"f\".concat(c)] = obj[c] = initPos[c] + (dragPos[c] - initPos[c]) / k;\n      });\n\n      // prevent freeze while dragging\n      state.forceGraph.d3AlphaTarget(0.3) // keep engine running at low intensity throughout drag\n      .resetCountdown(); // prevent freeze while dragging\n\n      state.isPointerDragging = true;\n      obj.__dragged = true;\n      state.onNodeDrag(obj, translate);\n    }).on('end', function (ev) {\n      var obj = ev.subject;\n      var initPos = obj.__initialDragPos;\n      var translate = {\n        x: obj.x - initPos.x,\n        y: obj.y - initPos.y\n      };\n      if (initPos.fx === undefined) {\n        obj.fx = undefined;\n      }\n      if (initPos.fy === undefined) {\n        obj.fy = undefined;\n      }\n      delete obj.__initialDragPos;\n      if (state.forceGraph.d3AlphaTarget()) {\n        state.forceGraph.d3AlphaTarget(0) // release engine low intensity\n        .resetCountdown(); // let the engine readjust after releasing fixed nodes\n      }\n\n      // drag cursor\n      state.canvas.classList.remove('grabbable');\n      state.isPointerDragging = false;\n      if (obj.__dragged) {\n        delete obj.__dragged;\n        state.onNodeDragEnd(obj, translate);\n      }\n    }));\n\n    // Setup zoom / pan interaction\n    state.zoom(state.zoom.__baseElem = select(state.canvas)); // Attach controlling elem for easy access\n\n    state.zoom.__baseElem.on('dblclick.zoom', null); // Disable double-click to zoom\n\n    state.zoom.filter(function (ev) {\n      return (\n        // disable zoom interaction\n        !ev.button && state.enableZoomPanInteraction && (state.enableZoomInteraction || ev.type !== 'wheel') && (state.enablePanInteraction || ev.type === 'wheel')\n      );\n    }).on('zoom', function (ev) {\n      var t = ev.transform;\n      [ctx, shadowCtx].forEach(function (c) {\n        resetTransform(c);\n        c.translate(t.x, t.y);\n        c.scale(t.k, t.k);\n      });\n      state.onZoom && state.onZoom(_objectSpread2(_objectSpread2({}, t), _this.centerAt())); // report x,y coordinates relative to canvas center\n      state.needsRedraw = true;\n    }).on('end', function (ev) {\n      return state.onZoomEnd && state.onZoomEnd(_objectSpread2(_objectSpread2({}, ev.transform), _this.centerAt()));\n    });\n    adjustCanvasSize(state);\n    state.forceGraph.onNeedsRedraw(function () {\n      return state.needsRedraw = true;\n    }).onFinishUpdate(function () {\n      // re-zoom, if still in default position (not user modified)\n      if (zoomTransform(state.canvas).k === state.lastSetZoom && state.graphData.nodes.length) {\n        state.zoom.scaleTo(state.zoom.__baseElem, state.lastSetZoom = ZOOM2NODES_FACTOR / Math.cbrt(state.graphData.nodes.length));\n        state.needsRedraw = true;\n      }\n    });\n\n    // Setup tooltip\n    var toolTipElem = document.createElement('div');\n    toolTipElem.classList.add('graph-tooltip');\n    container.appendChild(toolTipElem);\n\n    // Capture pointer coords on move or touchstart\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return container.addEventListener(evType, function (ev) {\n        if (evType === 'pointerdown') {\n          state.isPointerPressed = true; // track click state\n          state.pointerDownEvent = ev;\n        }\n\n        // detect pointer drag on canvas pan\n        !state.isPointerDragging && ev.type === 'pointermove' && state.onBackgroundClick // only bother detecting drags this way if background clicks are enabled (so they don't trigger accidentally on canvas panning)\n        && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we use the isPointerPressed tracker\n        && (ev.pointerType !== 'touch' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on touch events\n        && (state.isPointerDragging = true);\n\n        // update the pointer pos\n        var offset = getOffset(container);\n        pointerPos.x = ev.pageX - offset.left;\n        pointerPos.y = ev.pageY - offset.top;\n\n        // Move tooltip\n        toolTipElem.style.top = \"\".concat(pointerPos.y, \"px\");\n        toolTipElem.style.left = \"\".concat(pointerPos.x, \"px\");\n\n        // adjust horizontal position to not exceed canvas boundaries\n        toolTipElem.style.transform = \"translate(-\".concat(pointerPos.x / state.width * 100, \"%, \").concat(\n        // flip to above if near bottom\n        state.height - pointerPos.y < 100 ? 'calc(-100% - 8px)' : '21px', \")\");\n\n        //\n\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n            scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n            scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    });\n\n    // Handle click/touch events on nodes/links\n    container.addEventListener('pointerup', function (ev) {\n      state.isPointerPressed = false;\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        return; // don't trigger click events after pointer drag (pan / node drag functionality)\n      }\n\n      var cbEvents = [ev, state.pointerDownEvent];\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // mouse left-click or touch\n          if (state.hoverObj) {\n            var fn = state[\"on\".concat(state.hoverObj.type, \"Click\")];\n            fn && fn.apply(void 0, [state.hoverObj.d].concat(cbEvents));\n          } else {\n            state.onBackgroundClick && state.onBackgroundClick.apply(state, cbEvents);\n          }\n        }\n        if (ev.button === 2) {\n          // mouse right-click\n          if (state.hoverObj) {\n            var _fn = state[\"on\".concat(state.hoverObj.type, \"RightClick\")];\n            _fn && _fn.apply(void 0, [state.hoverObj.d].concat(cbEvents));\n          } else {\n            state.onBackgroundRightClick && state.onBackgroundRightClick.apply(state, cbEvents);\n          }\n        }\n      });\n    }, {\n      passive: true\n    });\n    container.addEventListener('contextmenu', function (ev) {\n      if (!state.onBackgroundRightClick && !state.onNodeRightClick && !state.onLinkRightClick) return true; // default contextmenu behavior\n      ev.preventDefault();\n      return false;\n    });\n    state.forceGraph(ctx);\n    state.shadowGraph(shadowCtx);\n\n    //\n\n    var refreshShadowCanvas = throttle(function () {\n      // wipe canvas\n      clearCanvas(shadowCtx, state.width, state.height);\n\n      // Adjust link hover area\n      state.shadowGraph.linkWidth(function (l) {\n        return accessorFn(state.linkWidth)(l) + state.linkHoverPrecision;\n      });\n\n      // redraw\n      var t = zoomTransform(state.canvas);\n      state.shadowGraph.globalScale(t.k).tickFrame();\n    }, HOVER_CANVAS_THROTTLE_DELAY);\n    state.flushShadowCanvas = refreshShadowCanvas.flush; // hook to immediately invoke shadow canvas paint\n\n    // Kick-off renderer\n    (this._animationCycle = function animate() {\n      // IIFE\n      var doRedraw = !state.autoPauseRedraw || !!state.needsRedraw || state.forceGraph.isEngineRunning() || state.graphData.links.some(function (d) {\n        return d.__photons && d.__photons.length;\n      });\n      state.needsRedraw = false;\n      if (state.enablePointerInteraction) {\n        // Update tooltip and trigger onHover events\n        var obj = !state.isPointerDragging ? getObjUnderPointer() : null; // don't hover during drag\n        if (obj !== state.hoverObj) {\n          var prevObj = state.hoverObj;\n          var prevObjType = prevObj ? prevObj.type : null;\n          var objType = obj ? obj.type : null;\n          if (prevObjType && prevObjType !== objType) {\n            // Hover out\n            var fn = state[\"on\".concat(prevObjType, \"Hover\")];\n            fn && fn(null, prevObj.d);\n          }\n          if (objType) {\n            // Hover in\n            var _fn2 = state[\"on\".concat(objType, \"Hover\")];\n            _fn2 && _fn2(obj.d, prevObjType === objType ? prevObj.d : null);\n          }\n          var tooltipContent = obj ? accessorFn(state[\"\".concat(obj.type.toLowerCase(), \"Label\")])(obj.d) || '' : '';\n          toolTipElem.style.visibility = tooltipContent ? 'visible' : 'hidden';\n          toolTipElem.innerHTML = tooltipContent;\n\n          // set pointer if hovered object is clickable\n          state.canvas.classList[obj && state[\"on\".concat(objType, \"Click\")] || !obj && state.onBackgroundClick ? 'add' : 'remove']('clickable');\n          state.hoverObj = obj;\n        }\n        doRedraw && refreshShadowCanvas();\n      }\n      if (doRedraw) {\n        // Wipe canvas\n        clearCanvas(ctx, state.width, state.height);\n\n        // Frame cycle\n        var globalScale = zoomTransform(state.canvas).k;\n        state.onRenderFramePre && state.onRenderFramePre(ctx, globalScale);\n        state.forceGraph.globalScale(globalScale).tickFrame();\n        state.onRenderFramePost && state.onRenderFramePost(ctx, globalScale);\n      }\n      TWEEN.update(); // update canvas animation tweens\n\n      state.animationFrameRequestId = requestAnimationFrame(animate);\n    })();\n  },\n  update: function updateFn(state) {}\n});\n\nexport { forceGraph as default };\n"]},"metadata":{},"sourceType":"module"}