{"ast":null,"code":"import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereGeometry, CylinderGeometry, TubeGeometry, ConeGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n\n  if (null != _i) {\n    var _s,\n        _e,\n        _x,\n        _r,\n        _arr = [],\n        _n = !0,\n        _d = !1;\n\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n\n    return _arr;\n  }\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\n\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n\n  return _construct.apply(null, arguments);\n}\n\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n\n  return target;\n}\n\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n\n  var key, i;\n\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n\n  return target;\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n        result;\n\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return _possibleConstructorReturn(this, result);\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n\n  return arr2;\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n\n  return (hint === \"string\" ? String : Number)(input);\n}\n\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n\n    material.dispose();\n  }\n};\n\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\n\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\n\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref$objFilter = _ref.objFilter,\n      objFilter = _ref$objFilter === void 0 ? function () {\n    return true;\n  } : _ref$objFilter,\n      options = _objectWithoutProperties(_ref, _excluded);\n\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\n\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\n\nvar autoColorScale = scaleOrdinal(schemePaired); // Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\n\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths(_ref, idAccessor) {\n  var nodes = _ref.nodes,\n      links = _ref.links;\n\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref2$nodeFilter = _ref2.nodeFilter,\n      nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n    return true;\n  } : _ref2$nodeFilter,\n      _ref2$onLoopError = _ref2.onLoopError,\n      onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n    throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n  } : _ref2$onLoopError; // linked graph\n\n\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n        target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n        node = _ref5[1];\n\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n        id = _ref7[0],\n        node = _ref7[1];\n\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n\n    var _loop = function _loop() {\n      var node = nodes[i];\n\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n\n        return \"continue\";\n      }\n\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n\n      if (_ret === \"continue\") continue;\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n}; //\n\nvar DAG_LEVEL_NODE_RATIO = 2; // support multiple method names for backwards threejs compatibility\n\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge'); // Increase repulsion on 3D mode for improved spatial separation\n\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n\n      state._rerender();\n\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n\n      if (state.engineRunning) {\n        layoutTick();\n      }\n\n      updateArrows();\n      updatePhotons();\n      return this; //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n\n          state.onEngineTick();\n        }\n\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend); // Update nodes position\n\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        }); // Update links position\n\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj, // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n\n          var curveResolution = 30; // # line segments\n\n          var curve = link.__curve; // select default line obj if it's an extended group\n\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n\n              var _r = _linkWidth / 2;\n\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        }); //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n\n            link.__curve = curve;\n          }\n        }\n      }\n\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n\n          arrowObj.lookAt(headVec);\n        });\n      }\n\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n\n            photon.__progressRatio += particleSpeed;\n\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        }); // add a single hop particle\n\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null; // recursively collect all nested geometries bboxes\n\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n\n      if (!bboxes.length) return null; // extract global x,y,z min/max\n\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n\n    state.engineRunning = false; // pause simulation\n\n    state.onUpdate();\n\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    } // Digest nodes WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n\n          var obj;\n\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n              }\n\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    } // Digest links WebGL objects\n\n\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n\n      var _colorAccessor = accessorFn(state.linkColor);\n\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor); // lines digest cycle\n\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([// recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        exitObj: function exitObj(obj) {\n          // remove trailing single photons\n          var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n\n          if (singlePhotonsObj) {\n            singlePhotonsObj.parent.remove(singlePhotonsObj);\n            emptyObject(singlePhotonsObj);\n            delete obj.__data.__singleHopPhotonsObj;\n          }\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n\n          var extendObj = _customObjectExtendAccessor(link);\n\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n\n          var defaultObj;\n\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n\n          var obj;\n\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n\n            var customMaterial = customMaterialAccessor(link);\n\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      }); // Arrows digest cycle\n\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments); // Correct orientation\n\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n\n            var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n            obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n          }\n        });\n      } // Photon particles digest cycle\n\n\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            } // digest cycle for each photon\n\n\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n\n    state._flushObjects = false; // reset objects refresh flag\n    // simulation engine\n\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n      // parse links\n\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      }); // Feed data to force-directed layout\n\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes); // add links (if link force is still active)\n\n        var linkForce = state.d3ForceLayout.force('link');\n\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        } // setup dag force constraints\n\n\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1); // Fix nodes to x,y,z for dag mode\n\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        } // Use radial force for radial dags\n\n\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule(kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n\n    var _super = _createSuper(FromKapsule);\n\n    function FromKapsule() {\n      var _this;\n\n      _classCallCheck(this, FromKapsule);\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n\n\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\n\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\nexport { threeForcegraph as default };","map":{"version":3,"sources":["/Users/samuelwright/Projects/portfolio/node_modules/three-forcegraph/dist/three-forcegraph.mjs"],"names":["Group","Mesh","MeshLambertMaterial","Color","BufferGeometry","BufferAttribute","Matrix4","Vector3","SphereGeometry","CylinderGeometry","TubeGeometry","ConeGeometry","Line","LineBasicMaterial","QuadraticBezierCurve3","CubicBezierCurve3","Box3","forceSimulation","forceLink","forceManyBody","forceCenter","forceRadial","graph","forcelayout","Kapsule","accessorFn","min","max","dataJoint","scaleOrdinal","schemePaired","tinyColor","_iterableToArrayLimit","arr","i","_i","Symbol","iterator","_s","_e","_x","_r","_arr","_n","_d","call","next","Object","done","push","value","length","err","return","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","apply","_objectSpread2","target","arguments","source","forEach","key","_defineProperty","getOwnPropertyDescriptors","defineProperties","defineProperty","_typeof","obj","constructor","prototype","_classCallCheck","instance","Constructor","TypeError","_defineProperties","props","descriptor","configurable","writable","_toPropertyKey","_createClass","protoProps","staticProps","_inherits","subClass","superClass","create","_setPrototypeOf","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","bind","__proto__","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Boolean","valueOf","e","_construct","Parent","args","Class","a","Function","_objectWithoutPropertiesLoose","excluded","sourceKeys","indexOf","_objectWithoutProperties","sourceSymbolKeys","propertyIsEnumerable","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","_createSuper","Derived","hasNativeReflectConstruct","_createSuperInternal","Super","result","NewTarget","_slicedToArray","_arrayWithHoles","_unsupportedIterableToArray","_nonIterableRest","_toConsumableArray","_arrayWithoutHoles","_iterableToArray","_nonIterableSpread","Array","isArray","_arrayLikeToArray","iter","from","minLen","n","toString","slice","name","test","len","arr2","_toPrimitive","input","hint","prim","toPrimitive","undefined","res","String","Number","arg","materialDispose","material","map","dispose","deallocate","geometry","texture","children","emptyObject","childObj","remove","_excluded","threeDigest","data","scene","_ref","_ref$objFilter","objFilter","options","add","objBindAttr","colorStr2Hex","str","isNaN","parseInt","toHex","colorAlpha","getAlpha","autoColorScale","autoColorObjects","objects","colorByAccessor","colorField","getDagDepths","idAccessor","nodes","links","_ref2","_ref2$nodeFilter","nodeFilter","_ref2$onLoopError","onLoopError","loopIds","concat","join","node","out","depth","skip","_ref3","sourceId","getNodeId","targetId","hasOwnProperty","sourceNode","targetNode","foundLoops","traverse","values","nodeDepths","assign","entries","_ref4","_ref5","_ref6","_ref7","id","nodeStack","currentDepth","_loop","loop","d","some","foundLoop","every","idx","l","_ret","three$1","window","THREE","ngraph","DAG_LEVEL_NODE_RATIO","setAttributeFn","setAttribute","applyMatrix4Fn","applyMatrix4","ForceGraph","jsonUrl","onChange","state","_this","fetchingJson","onLoading","fetch","then","r","json","onFinishLoading","graphData","triggerUpdate","engineRunning","numDimensions","numDim","chargeForce","d3ForceLayout","force","strength","eraseDimension","dim","dagMode","forceEngine","fx","fy","fz","dagLevelDistance","dagNodeFilter","_default","onDagError","nodeRelSize","nodeId","nodeVal","nodeResolution","nodeColor","nodeAutoColorBy","nodeOpacity","nodeVisibility","nodeThreeObject","nodeThreeObjectExtend","nodePositionUpdate","linkSource","linkTarget","linkVisibility","linkColor","linkAutoColorBy","linkOpacity","linkWidth","linkResolution","linkCurvature","linkCurveRotation","linkMaterial","linkThreeObject","linkThreeObjectExtend","linkPositionUpdate","linkDirectionalArrowLength","linkDirectionalArrowColor","linkDirectionalArrowRelPos","linkDirectionalArrowResolution","linkDirectionalParticles","linkDirectionalParticleSpeed","linkDirectionalParticleWidth","linkDirectionalParticleColor","linkDirectionalParticleResolution","d3AlphaMin","d3AlphaDecay","alphaDecay","d3AlphaTarget","alphaTarget","d3VelocityDecay","velocityDecay","ngraphPhysics","timeStep","gravity","theta","springLength","springCoefficient","dragCoefficient","warmupTicks","cooldownTicks","Infinity","cooldownTime","onUpdate","onFinishUpdate","onEngineTick","onEngineStop","methods","refresh","_flushObjects","_rerender","d3Force","forceName","forceFn","d3ReheatSimulation","alpha","resetCountdown","cntTicks","startTickTime","Date","tickFrame","isD3Sim","layoutTick","updateArrows","updatePhotons","layout","nodeThreeObjectExtendAccessor","__threeObj","pos","getNodePosition","extendedObj","x","y","z","position","linkWidthAccessor","linkCurvatureAccessor","linkCurveRotationAccessor","linkThreeObjectExtendAccessor","link","lineObj","__lineObj","getLinkPosition","getLink","start","end","calcLinkCurve","curveResolution","curve","__curve","line","type","linePos","getAttribute","array","Float32Array","needsUpdate","setFromPoints","getPoints","computeBoundingSphere","match","Math","ceil","makeTranslation","makeRotationX","PI","vStart","vEnd","distance","distanceTo","scale","parent","localToWorld","lookAt","set","rotation","_linkWidth","_geometry","curvature","curveRotation","dx","dy","vLine","subVectors","cp","clone","multiplyScalar","cross","applyAxisAngle","normalize","addVectors","divideScalar","endAngle","startAngle","cos","sin","arrowRelPosAccessor","arrowLengthAccessor","nodeValAccessor","arrowObj","__arrowObj","startR","cbrt","endR","arrowLength","arrowRelPos","getPosAlongLine","t","getPoint","iplt","lineLen","getLength","sqrt","pow","reduce","acc","v","posAlongLine","arrowHead","arrowTail","headVec","c","particleSpeedAccessor","cyclePhotons","__photonsObj","singleHopPhotons","__singleHopPhotonsObj","particleSpeed","getPhotonPos","photons","photon","singleHop","__linkThreeObjType","__progressRatio","photonPosRatio","emitParticle","includes","graphScene","particleWidthAccessor","photonR","numSegments","particleGeometry","linkColorAccessor","particleColorAccessor","photonColor","materialColor","opacity","particleMaterial","color","transparent","getGraphBbox","initialised","bboxes","getBboxes","computeBoundingBox","box","copy","boundingBox","matrixWorld","__graphObjType","__data","bb","stateInit","stop","init","threeObj","update","changedProps","hasAnyPropChanged","propList","customObjectAccessor","customObjectExtendAccessor","valAccessor","colorAccessor","visibilityAccessor","sphereGeometries","sphereMaterials","purge","createObj","customObj","extendObj","__graphDefaultObj","updateObj","val","radius","parameters","widthSegments","equals","_customObjectAccessor","_customObjectExtendAccessor","customMaterialAccessor","_visibilityAccessor","_colorAccessor","widthAccessor","cylinderGeometries","lambertLineMaterials","basicLineMaterials","visibleLinks","exitObj","singlePhotonsObj","defaultObj","useCylinder","lineGeometry","renderOrder","updObj","radiusTop","radialSegments","customMaterial","materialType","lineMaterials","depthWrite","arrowColorAccessor","height","coneGeometry","translate","rotateX","arrowColor","particlesAccessor","particleMaterials","particleGeometries","numPhotons","round","abs","curPhoton","_","linkForce","maxDepth","getFFn","fix","invert","fxFn","fyFn","fzFn","nodeDepth","_graph","addNode","addLink","dimensions","fromKapsule","kapsule","baseClass","initKapsuleWithSelf","FromKapsule","_baseClass","_super","_len","_key","__kapsuleInstance","m","_this$__kapsuleInstan","returnVal","three","threeForcegraph","default"],"mappings":"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","sourcesContent":["import { Group, Mesh, MeshLambertMaterial, Color, BufferGeometry, BufferAttribute, Matrix4, Vector3, SphereGeometry, CylinderGeometry, TubeGeometry, ConeGeometry, Line, LineBasicMaterial, QuadraticBezierCurve3, CubicBezierCurve3, Box3 } from 'three';\nimport { forceSimulation, forceLink, forceManyBody, forceCenter, forceRadial } from 'd3-force-3d';\nimport graph from 'ngraph.graph';\nimport forcelayout from 'ngraph.forcelayout';\nimport Kapsule from 'kapsule';\nimport accessorFn from 'accessor-fn';\nimport { min, max } from 'd3-array';\nimport dataJoint from 'data-joint';\nimport { scaleOrdinal } from 'd3-scale';\nimport { schemePaired } from 'd3-scale-chromatic';\nimport tinyColor from 'tinycolor2';\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _i = null == arr ? null : \"undefined\" != typeof Symbol && arr[Symbol.iterator] || arr[\"@@iterator\"];\n  if (null != _i) {\n    var _s,\n      _e,\n      _x,\n      _r,\n      _arr = [],\n      _n = !0,\n      _d = !1;\n    try {\n      if (_x = (_i = _i.call(arr)).next, 0 === i) {\n        if (Object(_i) !== _i) return;\n        _n = !1;\n      } else for (; !(_n = (_s = _x.call(_i)).done) && (_arr.push(_s.value), _arr.length !== i); _n = !0);\n    } catch (err) {\n      _d = !0, _e = err;\n    } finally {\n      try {\n        if (!_n && null != _i.return && (_r = _i.return(), Object(_r) !== _r)) return;\n      } finally {\n        if (_d) throw _e;\n      }\n    }\n    return _arr;\n  }\n}\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    enumerableOnly && (symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    })), keys.push.apply(keys, symbols);\n  }\n  return keys;\n}\nfunction _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = null != arguments[i] ? arguments[i] : {};\n    i % 2 ? ownKeys(Object(source), !0).forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)) : ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n  return target;\n}\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor);\n  }\n}\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  Object.defineProperty(Constructor, \"prototype\", {\n    writable: false\n  });\n  return Constructor;\n}\nfunction _defineProperty(obj, key, value) {\n  key = _toPropertyKey(key);\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n  return obj;\n}\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  Object.defineProperty(subClass, \"prototype\", {\n    writable: false\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}\nfunction _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n  try {\n    Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\nfunction _construct(Parent, args, Class) {\n  if (_isNativeReflectConstruct()) {\n    _construct = Reflect.construct.bind();\n  } else {\n    _construct = function _construct(Parent, args, Class) {\n      var a = [null];\n      a.push.apply(a, args);\n      var Constructor = Function.bind.apply(Parent, a);\n      var instance = new Constructor();\n      if (Class) _setPrototypeOf(instance, Class.prototype);\n      return instance;\n    };\n  }\n  return _construct.apply(null, arguments);\n}\nfunction _objectWithoutPropertiesLoose(source, excluded) {\n  if (source == null) return {};\n  var target = {};\n  var sourceKeys = Object.keys(source);\n  var key, i;\n  for (i = 0; i < sourceKeys.length; i++) {\n    key = sourceKeys[i];\n    if (excluded.indexOf(key) >= 0) continue;\n    target[key] = source[key];\n  }\n  return target;\n}\nfunction _objectWithoutProperties(source, excluded) {\n  if (source == null) return {};\n  var target = _objectWithoutPropertiesLoose(source, excluded);\n  var key, i;\n  if (Object.getOwnPropertySymbols) {\n    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);\n    for (i = 0; i < sourceSymbolKeys.length; i++) {\n      key = sourceSymbolKeys[i];\n      if (excluded.indexOf(key) >= 0) continue;\n      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;\n      target[key] = source[key];\n    }\n  }\n  return target;\n}\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n  return self;\n}\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (typeof call === \"object\" || typeof call === \"function\")) {\n    return call;\n  } else if (call !== void 0) {\n    throw new TypeError(\"Derived constructors may only return object or undefined\");\n  }\n  return _assertThisInitialized(self);\n}\nfunction _createSuper(Derived) {\n  var hasNativeReflectConstruct = _isNativeReflectConstruct();\n  return function _createSuperInternal() {\n    var Super = _getPrototypeOf(Derived),\n      result;\n    if (hasNativeReflectConstruct) {\n      var NewTarget = _getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n    return _possibleConstructorReturn(this, result);\n  };\n}\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest();\n}\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter);\n}\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n  for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i];\n  return arr2;\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _toPrimitive(input, hint) {\n  if (typeof input !== \"object\" || input === null) return input;\n  var prim = input[Symbol.toPrimitive];\n  if (prim !== undefined) {\n    var res = prim.call(input, hint || \"default\");\n    if (typeof res !== \"object\") return res;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (hint === \"string\" ? String : Number)(input);\n}\nfunction _toPropertyKey(arg) {\n  var key = _toPrimitive(arg, \"string\");\n  return typeof key === \"symbol\" ? key : String(key);\n}\n\nvar materialDispose = function materialDispose(material) {\n  if (material instanceof Array) {\n    material.forEach(materialDispose);\n  } else {\n    if (material.map) {\n      material.map.dispose();\n    }\n    material.dispose();\n  }\n};\nvar deallocate = function deallocate(obj) {\n  if (obj.geometry) {\n    obj.geometry.dispose();\n  }\n  if (obj.material) {\n    materialDispose(obj.material);\n  }\n  if (obj.texture) {\n    obj.texture.dispose();\n  }\n  if (obj.children) {\n    obj.children.forEach(deallocate);\n  }\n};\nvar emptyObject = function emptyObject(obj) {\n  while (obj.children.length) {\n    var childObj = obj.children[0];\n    obj.remove(childObj);\n    deallocate(childObj);\n  }\n};\n\nvar _excluded = [\"objFilter\"];\nfunction threeDigest(data, scene) {\n  var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref$objFilter = _ref.objFilter,\n    objFilter = _ref$objFilter === void 0 ? function () {\n      return true;\n    } : _ref$objFilter,\n    options = _objectWithoutProperties(_ref, _excluded);\n  return dataJoint(data, scene.children.filter(objFilter), function (obj) {\n    return scene.add(obj);\n  }, function (obj) {\n    scene.remove(obj);\n    emptyObject(obj);\n  }, _objectSpread2({\n    objBindAttr: '__threeObj'\n  }, options));\n}\n\nvar colorStr2Hex = function colorStr2Hex(str) {\n  return isNaN(str) ? parseInt(tinyColor(str).toHex(), 16) : str;\n};\nvar colorAlpha = function colorAlpha(str) {\n  return isNaN(str) ? tinyColor(str).getAlpha() : 1;\n};\nvar autoColorScale = scaleOrdinal(schemePaired);\n\n// Autoset attribute colorField by colorByAccessor property\n// If an object has already a color, don't set it\n// Objects can be nodes or links\nfunction autoColorObjects(objects, colorByAccessor, colorField) {\n  if (!colorByAccessor || typeof colorField !== 'string') return;\n  objects.filter(function (obj) {\n    return !obj[colorField];\n  }).forEach(function (obj) {\n    obj[colorField] = autoColorScale(colorByAccessor(obj));\n  });\n}\n\nfunction getDagDepths (_ref, idAccessor) {\n  var nodes = _ref.nodes,\n    links = _ref.links;\n  var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n    _ref2$nodeFilter = _ref2.nodeFilter,\n    nodeFilter = _ref2$nodeFilter === void 0 ? function () {\n      return true;\n    } : _ref2$nodeFilter,\n    _ref2$onLoopError = _ref2.onLoopError,\n    onLoopError = _ref2$onLoopError === void 0 ? function (loopIds) {\n      throw \"Invalid DAG structure! Found cycle in node path: \".concat(loopIds.join(' -> '), \".\");\n    } : _ref2$onLoopError;\n  // linked graph\n  var graph = {};\n  nodes.forEach(function (node) {\n    return graph[idAccessor(node)] = {\n      data: node,\n      out: [],\n      depth: -1,\n      skip: !nodeFilter(node)\n    };\n  });\n  links.forEach(function (_ref3) {\n    var source = _ref3.source,\n      target = _ref3.target;\n    var sourceId = getNodeId(source);\n    var targetId = getNodeId(target);\n    if (!graph.hasOwnProperty(sourceId)) throw \"Missing source node with id: \".concat(sourceId);\n    if (!graph.hasOwnProperty(targetId)) throw \"Missing target node with id: \".concat(targetId);\n    var sourceNode = graph[sourceId];\n    var targetNode = graph[targetId];\n    sourceNode.out.push(targetNode);\n    function getNodeId(node) {\n      return _typeof(node) === 'object' ? idAccessor(node) : node;\n    }\n  });\n  var foundLoops = [];\n  traverse(Object.values(graph));\n  var nodeDepths = Object.assign.apply(Object, [{}].concat(_toConsumableArray(Object.entries(graph).filter(function (_ref4) {\n    var _ref5 = _slicedToArray(_ref4, 2),\n      node = _ref5[1];\n    return !node.skip;\n  }).map(function (_ref6) {\n    var _ref7 = _slicedToArray(_ref6, 2),\n      id = _ref7[0],\n      node = _ref7[1];\n    return _defineProperty({}, id, node.depth);\n  }))));\n  return nodeDepths;\n  function traverse(nodes) {\n    var nodeStack = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];\n    var currentDepth = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    var _loop = function _loop() {\n      var node = nodes[i];\n      if (nodeStack.indexOf(node) !== -1) {\n        var loop = [].concat(_toConsumableArray(nodeStack.slice(nodeStack.indexOf(node))), [node]).map(function (d) {\n          return idAccessor(d.data);\n        });\n        if (!foundLoops.some(function (foundLoop) {\n          return foundLoop.length === loop.length && foundLoop.every(function (id, idx) {\n            return id === loop[idx];\n          });\n        })) {\n          foundLoops.push(loop);\n          onLoopError(loop);\n        }\n        return \"continue\";\n      }\n      if (currentDepth > node.depth) {\n        // Don't unnecessarily revisit chunks of the graph\n        node.depth = currentDepth;\n        traverse(node.out, [].concat(_toConsumableArray(nodeStack), [node]), currentDepth + (node.skip ? 0 : 1));\n      }\n    };\n    for (var i = 0, l = nodes.length; i < l; i++) {\n      var _ret = _loop();\n      if (_ret === \"continue\") continue;\n    }\n  }\n}\n\nvar three$1 = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  Group: Group,\n  Mesh: Mesh,\n  MeshLambertMaterial: MeshLambertMaterial,\n  Color: Color,\n  BufferGeometry: BufferGeometry,\n  BufferAttribute: BufferAttribute,\n  Matrix4: Matrix4,\n  Vector3: Vector3,\n  SphereGeometry: SphereGeometry,\n  CylinderGeometry: CylinderGeometry,\n  TubeGeometry: TubeGeometry,\n  ConeGeometry: ConeGeometry,\n  Line: Line,\n  LineBasicMaterial: LineBasicMaterial,\n  QuadraticBezierCurve3: QuadraticBezierCurve3,\n  CubicBezierCurve3: CubicBezierCurve3,\n  Box3: Box3\n};\nvar ngraph = {\n  graph: graph,\n  forcelayout: forcelayout\n};\n\n//\n\nvar DAG_LEVEL_NODE_RATIO = 2;\n\n// support multiple method names for backwards threejs compatibility\nvar setAttributeFn = new three$1.BufferGeometry().setAttribute ? 'setAttribute' : 'addAttribute';\nvar applyMatrix4Fn = new three$1.BufferGeometry().applyMatrix4 ? 'applyMatrix4' : 'applyMatrix';\nvar ForceGraph = Kapsule({\n  props: {\n    jsonUrl: {\n      onChange: function onChange(jsonUrl, state) {\n        var _this = this;\n        if (jsonUrl && !state.fetchingJson) {\n          // Load data asynchronously\n          state.fetchingJson = true;\n          state.onLoading();\n          fetch(jsonUrl).then(function (r) {\n            return r.json();\n          }).then(function (json) {\n            state.fetchingJson = false;\n            state.onFinishLoading(json);\n            _this.graphData(json);\n          });\n        }\n      },\n      triggerUpdate: false\n    },\n    graphData: {\n      \"default\": {\n        nodes: [],\n        links: []\n      },\n      onChange: function onChange(graphData, state) {\n        state.engineRunning = false; // Pause simulation immediately\n      }\n    },\n\n    numDimensions: {\n      \"default\": 3,\n      onChange: function onChange(numDim, state) {\n        var chargeForce = state.d3ForceLayout.force('charge');\n        // Increase repulsion on 3D mode for improved spatial separation\n        if (chargeForce) {\n          chargeForce.strength(numDim > 2 ? -60 : -30);\n        }\n        if (numDim < 3) {\n          eraseDimension(state.graphData.nodes, 'z');\n        }\n        if (numDim < 2) {\n          eraseDimension(state.graphData.nodes, 'y');\n        }\n        function eraseDimension(nodes, dim) {\n          nodes.forEach(function (d) {\n            delete d[dim]; // position\n            delete d[\"v\".concat(dim)]; // velocity\n          });\n        }\n      }\n    },\n\n    dagMode: {\n      onChange: function onChange(dagMode, state) {\n        // td, bu, lr, rl, zin, zout, radialin, radialout\n        !dagMode && state.forceEngine === 'd3' && (state.graphData.nodes || []).forEach(function (n) {\n          return n.fx = n.fy = n.fz = undefined;\n        }); // unfix nodes when disabling dag mode\n      }\n    },\n\n    dagLevelDistance: {},\n    dagNodeFilter: {\n      \"default\": function _default(node) {\n        return true;\n      }\n    },\n    onDagError: {\n      triggerUpdate: false\n    },\n    nodeRelSize: {\n      \"default\": 4\n    },\n    // volume per val unit\n    nodeId: {\n      \"default\": 'id'\n    },\n    nodeVal: {\n      \"default\": 'val'\n    },\n    nodeResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the sphere's circumference\n    nodeColor: {\n      \"default\": 'color'\n    },\n    nodeAutoColorBy: {},\n    nodeOpacity: {\n      \"default\": 0.75\n    },\n    nodeVisibility: {\n      \"default\": true\n    },\n    nodeThreeObject: {},\n    nodeThreeObjectExtend: {\n      \"default\": false\n    },\n    nodePositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the node's position. Signature: (threeObj, { x, y, z}, node). If the function returns a truthy value, the regular node position update will not run.\n    linkSource: {\n      \"default\": 'source'\n    },\n    linkTarget: {\n      \"default\": 'target'\n    },\n    linkVisibility: {\n      \"default\": true\n    },\n    linkColor: {\n      \"default\": 'color'\n    },\n    linkAutoColorBy: {},\n    linkOpacity: {\n      \"default\": 0.2\n    },\n    linkWidth: {},\n    // Rounded to nearest decimal. For falsy values use dimensionless line with 1px regardless of distance.\n    linkResolution: {\n      \"default\": 6\n    },\n    // how many radial segments in each line tube's geometry\n    linkCurvature: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curvature radius (0: straight, 1: semi-circle)\n    linkCurveRotation: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // line curve rotation along the line axis (0: interection with XY plane, PI: upside down)\n    linkMaterial: {},\n    linkThreeObject: {},\n    linkThreeObjectExtend: {\n      \"default\": false\n    },\n    linkPositionUpdate: {\n      triggerUpdate: false\n    },\n    // custom function to call for updating the link's position. Signature: (threeObj, { start: { x, y, z},  end: { x, y, z }}, link). If the function returns a truthy value, the regular link position update will not run.\n    linkDirectionalArrowLength: {\n      \"default\": 0\n    },\n    linkDirectionalArrowColor: {},\n    linkDirectionalArrowRelPos: {\n      \"default\": 0.5,\n      triggerUpdate: false\n    },\n    // value between 0<>1 indicating the relative pos along the (exposed) line\n    linkDirectionalArrowResolution: {\n      \"default\": 8\n    },\n    // how many slice segments in the arrow's conic circumference\n    linkDirectionalParticles: {\n      \"default\": 0\n    },\n    // animate photons travelling in the link direction\n    linkDirectionalParticleSpeed: {\n      \"default\": 0.01,\n      triggerUpdate: false\n    },\n    // in link length ratio per frame\n    linkDirectionalParticleWidth: {\n      \"default\": 0.5\n    },\n    linkDirectionalParticleColor: {},\n    linkDirectionalParticleResolution: {\n      \"default\": 4\n    },\n    // how many slice segments in the particle sphere's circumference\n    forceEngine: {\n      \"default\": 'd3'\n    },\n    // d3 or ngraph\n    d3AlphaMin: {\n      \"default\": 0\n    },\n    d3AlphaDecay: {\n      \"default\": 0.0228,\n      triggerUpdate: false,\n      onChange: function onChange(alphaDecay, state) {\n        state.d3ForceLayout.alphaDecay(alphaDecay);\n      }\n    },\n    d3AlphaTarget: {\n      \"default\": 0,\n      triggerUpdate: false,\n      onChange: function onChange(alphaTarget, state) {\n        state.d3ForceLayout.alphaTarget(alphaTarget);\n      }\n    },\n    d3VelocityDecay: {\n      \"default\": 0.4,\n      triggerUpdate: false,\n      onChange: function onChange(velocityDecay, state) {\n        state.d3ForceLayout.velocityDecay(velocityDecay);\n      }\n    },\n    ngraphPhysics: {\n      \"default\": {\n        // defaults from https://github.com/anvaka/ngraph.physics.simulator/blob/master/index.js\n        timeStep: 20,\n        gravity: -1.2,\n        theta: 0.8,\n        springLength: 30,\n        springCoefficient: 0.0008,\n        dragCoefficient: 0.02\n      }\n    },\n    warmupTicks: {\n      \"default\": 0,\n      triggerUpdate: false\n    },\n    // how many times to tick the force engine at init before starting to render\n    cooldownTicks: {\n      \"default\": Infinity,\n      triggerUpdate: false\n    },\n    cooldownTime: {\n      \"default\": 15000,\n      triggerUpdate: false\n    },\n    // ms\n    onLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishLoading: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onFinishUpdate: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineTick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onEngineStop: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    refresh: function refresh(state) {\n      state._flushObjects = true;\n      state._rerender();\n      return this;\n    },\n    // Expose d3 forces for external manipulation\n    d3Force: function d3Force(state, forceName, forceFn) {\n      if (forceFn === undefined) {\n        return state.d3ForceLayout.force(forceName); // Force getter\n      }\n\n      state.d3ForceLayout.force(forceName, forceFn); // Force setter\n      return this;\n    },\n    d3ReheatSimulation: function d3ReheatSimulation(state) {\n      state.d3ForceLayout.alpha(1);\n      this.resetCountdown();\n      return this;\n    },\n    // reset cooldown state\n    resetCountdown: function resetCountdown(state) {\n      state.cntTicks = 0;\n      state.startTickTime = new Date();\n      state.engineRunning = true;\n      return this;\n    },\n    tickFrame: function tickFrame(state) {\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      if (state.engineRunning) {\n        layoutTick();\n      }\n      updateArrows();\n      updatePhotons();\n      return this;\n\n      //\n\n      function layoutTick() {\n        if (++state.cntTicks > state.cooldownTicks || new Date() - state.startTickTime > state.cooldownTime || isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin) {\n          state.engineRunning = false; // Stop ticking graph\n          state.onEngineStop();\n        } else {\n          state.layout[isD3Sim ? 'tick' : 'step'](); // Tick it\n          state.onEngineTick();\n        }\n        var nodeThreeObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n\n        // Update nodes position\n        state.graphData.nodes.forEach(function (node) {\n          var obj = node.__threeObj;\n          if (!obj) return;\n          var pos = isD3Sim ? node : state.layout.getNodePosition(node[state.nodeId]);\n          var extendedObj = nodeThreeObjectExtendAccessor(node);\n          if (!state.nodePositionUpdate || !state.nodePositionUpdate(extendedObj ? obj.children[0] : obj, {\n            x: pos.x,\n            y: pos.y,\n            z: pos.z\n          }, node) // pass child custom object if extending the default\n          || extendedObj) {\n            obj.position.x = pos.x;\n            obj.position.y = pos.y || 0;\n            obj.position.z = pos.z || 0;\n          }\n        });\n\n        // Update links position\n        var linkWidthAccessor = accessorFn(state.linkWidth);\n        var linkCurvatureAccessor = accessorFn(state.linkCurvature);\n        var linkCurveRotationAccessor = accessorFn(state.linkCurveRotation);\n        var linkThreeObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n        state.graphData.links.forEach(function (link) {\n          var lineObj = link.__lineObj;\n          if (!lineObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          calcLinkCurve(link); // calculate link curve for all links, including custom replaced, so it can be used in directional functionality\n\n          var extendedObj = linkThreeObjectExtendAccessor(link);\n          if (state.linkPositionUpdate && state.linkPositionUpdate(extendedObj ? lineObj.children[1] : lineObj,\n          // pass child custom object if extending the default\n          {\n            start: {\n              x: start.x,\n              y: start.y,\n              z: start.z\n            },\n            end: {\n              x: end.x,\n              y: end.y,\n              z: end.z\n            }\n          }, link) && !extendedObj) {\n            // exit if successfully custom updated position of non-extended obj\n            return;\n          }\n          var curveResolution = 30; // # line segments\n          var curve = link.__curve;\n\n          // select default line obj if it's an extended group\n          var line = lineObj.children.length ? lineObj.children[0] : lineObj;\n          if (line.type === 'Line') {\n            // Update line geometry\n            if (!curve) {\n              // straight line\n              var linePos = line.geometry.getAttribute('position');\n              if (!linePos || !linePos.array || linePos.array.length !== 6) {\n                line.geometry[setAttributeFn]('position', linePos = new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              }\n              linePos.array[0] = start.x;\n              linePos.array[1] = start.y || 0;\n              linePos.array[2] = start.z || 0;\n              linePos.array[3] = end.x;\n              linePos.array[4] = end.y || 0;\n              linePos.array[5] = end.z || 0;\n              linePos.needsUpdate = true;\n            } else {\n              // bezier curve line\n              line.geometry.setFromPoints(curve.getPoints(curveResolution));\n            }\n            line.geometry.computeBoundingSphere();\n          } else if (line.type === 'Mesh') {\n            // Update cylinder geometry\n\n            if (!curve) {\n              // straight tube\n              if (!line.geometry.type.match(/^Cylinder(Buffer)?Geometry$/)) {\n                var linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n                var r = linkWidth / 2;\n                var geometry = new three$1.CylinderGeometry(r, r, 1, state.linkResolution, 1, false);\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                line.geometry.dispose();\n                line.geometry = geometry;\n              }\n              var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n              var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n              var distance = vStart.distanceTo(vEnd);\n              line.position.x = vStart.x;\n              line.position.y = vStart.y;\n              line.position.z = vStart.z;\n              line.scale.z = distance;\n              line.parent.localToWorld(vEnd); // lookAt requires world coords\n              line.lookAt(vEnd);\n            } else {\n              // curved tube\n              if (!line.geometry.type.match(/^Tube(Buffer)?Geometry$/)) {\n                // reset object positioning\n                line.position.set(0, 0, 0);\n                line.rotation.set(0, 0, 0);\n                line.scale.set(1, 1, 1);\n              }\n              var _linkWidth = Math.ceil(linkWidthAccessor(link) * 10) / 10;\n              var _r = _linkWidth / 2;\n              var _geometry = new three$1.TubeGeometry(curve, curveResolution, _r, state.linkResolution, false);\n              line.geometry.dispose();\n              line.geometry = _geometry;\n            }\n          }\n        });\n\n        //\n\n        function calcLinkCurve(link) {\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var curvature = linkCurvatureAccessor(link);\n          if (!curvature) {\n            link.__curve = null; // Straight line\n          } else {\n            // bezier curve line (only for line types)\n            var vStart = new three$1.Vector3(start.x, start.y || 0, start.z || 0);\n            var vEnd = new three$1.Vector3(end.x, end.y || 0, end.z || 0);\n            var l = vStart.distanceTo(vEnd); // line length\n\n            var curve;\n            var curveRotation = linkCurveRotationAccessor(link);\n            if (l > 0) {\n              var dx = end.x - start.x;\n              var dy = end.y - start.y || 0;\n              var vLine = new three$1.Vector3().subVectors(vEnd, vStart);\n              var cp = vLine.clone().multiplyScalar(curvature).cross(dx !== 0 || dy !== 0 ? new three$1.Vector3(0, 0, 1) : new three$1.Vector3(0, 1, 0)) // avoid cross-product of parallel vectors (prefer Z, fallback to Y)\n              .applyAxisAngle(vLine.normalize(), curveRotation) // rotate along line axis according to linkCurveRotation\n              .add(new three$1.Vector3().addVectors(vStart, vEnd).divideScalar(2));\n              curve = new three$1.QuadraticBezierCurve3(vStart, cp, vEnd);\n            } else {\n              // Same point, draw a loop\n              var d = curvature * 70;\n              var endAngle = -curveRotation; // Rotate clockwise (from Z angle perspective)\n              var startAngle = endAngle + Math.PI / 2;\n              curve = new three$1.CubicBezierCurve3(vStart, new three$1.Vector3(d * Math.cos(startAngle), d * Math.sin(startAngle), 0).add(vStart), new three$1.Vector3(d * Math.cos(endAngle), d * Math.sin(endAngle), 0).add(vStart), vEnd);\n            }\n            link.__curve = curve;\n          }\n        }\n      }\n      function updateArrows() {\n        // update link arrow position\n        var arrowRelPosAccessor = accessorFn(state.linkDirectionalArrowRelPos);\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var nodeValAccessor = accessorFn(state.nodeVal);\n        state.graphData.links.forEach(function (link) {\n          var arrowObj = link.__arrowObj;\n          if (!arrowObj) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var startR = Math.cbrt(Math.max(0, nodeValAccessor(start) || 1)) * state.nodeRelSize;\n          var endR = Math.cbrt(Math.max(0, nodeValAccessor(end) || 1)) * state.nodeRelSize;\n          var arrowLength = arrowLengthAccessor(link);\n          var arrowRelPos = arrowRelPosAccessor(link);\n          var getPosAlongLine = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var lineLen = link.__curve ? link.__curve.getLength() : Math.sqrt(['x', 'y', 'z'].map(function (dim) {\n            return Math.pow((end[dim] || 0) - (start[dim] || 0), 2);\n          }).reduce(function (acc, v) {\n            return acc + v;\n          }, 0));\n          var posAlongLine = startR + arrowLength + (lineLen - startR - endR - arrowLength) * arrowRelPos;\n          var arrowHead = getPosAlongLine(posAlongLine / lineLen);\n          var arrowTail = getPosAlongLine((posAlongLine - arrowLength) / lineLen);\n          ['x', 'y', 'z'].forEach(function (dim) {\n            return arrowObj.position[dim] = arrowTail[dim];\n          });\n          var headVec = _construct(three$1.Vector3, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n            return arrowHead[c];\n          })));\n          arrowObj.parent.localToWorld(headVec); // lookAt requires world coords\n          arrowObj.lookAt(headVec);\n        });\n      }\n      function updatePhotons() {\n        // update link particle positions\n        var particleSpeedAccessor = accessorFn(state.linkDirectionalParticleSpeed);\n        state.graphData.links.forEach(function (link) {\n          var cyclePhotons = link.__photonsObj && link.__photonsObj.children;\n          var singleHopPhotons = link.__singleHopPhotonsObj && link.__singleHopPhotonsObj.children;\n          if ((!singleHopPhotons || !singleHopPhotons.length) && (!cyclePhotons || !cyclePhotons.length)) return;\n          var pos = isD3Sim ? link : state.layout.getLinkPosition(state.layout.graph.getLink(link.source, link.target).id);\n          var start = pos[isD3Sim ? 'source' : 'from'];\n          var end = pos[isD3Sim ? 'target' : 'to'];\n          if (!start || !end || !start.hasOwnProperty('x') || !end.hasOwnProperty('x')) return; // skip invalid link\n\n          var particleSpeed = particleSpeedAccessor(link);\n          var getPhotonPos = link.__curve ? function (t) {\n            return link.__curve.getPoint(t);\n          } // interpolate along bezier curve\n          : function (t) {\n            // straight line: interpolate linearly\n            var iplt = function iplt(dim, start, end, t) {\n              return start[dim] + (end[dim] - start[dim]) * t || 0;\n            };\n            return {\n              x: iplt('x', start, end, t),\n              y: iplt('y', start, end, t),\n              z: iplt('z', start, end, t)\n            };\n          };\n          var photons = [].concat(_toConsumableArray(cyclePhotons || []), _toConsumableArray(singleHopPhotons || []));\n          photons.forEach(function (photon, idx) {\n            var singleHop = photon.parent.__linkThreeObjType === 'singleHopPhotons';\n            if (!photon.hasOwnProperty('__progressRatio')) {\n              photon.__progressRatio = singleHop ? 0 : idx / cyclePhotons.length;\n            }\n            photon.__progressRatio += particleSpeed;\n            if (photon.__progressRatio >= 1) {\n              if (!singleHop) {\n                photon.__progressRatio = photon.__progressRatio % 1;\n              } else {\n                // remove particle\n                photon.parent.remove(photon);\n                emptyObject(photon);\n                return;\n              }\n            }\n            var photonPosRatio = photon.__progressRatio;\n            var pos = getPhotonPos(photonPosRatio);\n            ['x', 'y', 'z'].forEach(function (dim) {\n              return photon.position[dim] = pos[dim];\n            });\n          });\n        });\n      }\n    },\n    emitParticle: function emitParticle(state, link) {\n      if (link && state.graphData.links.includes(link)) {\n        if (!link.__singleHopPhotonsObj) {\n          var obj = new three$1.Group();\n          obj.__linkThreeObjType = 'singleHopPhotons';\n          link.__singleHopPhotonsObj = obj;\n          state.graphScene.add(obj);\n        }\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n        var numSegments = state.linkDirectionalParticleResolution;\n        var particleGeometry = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n        var linkColorAccessor = accessorFn(state.linkColor);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var photonColor = particleColorAccessor(link) || linkColorAccessor(link) || '#f0f0f0';\n        var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n        var opacity = state.linkOpacity * 3;\n        var particleMaterial = new three$1.MeshLambertMaterial({\n          color: materialColor,\n          transparent: true,\n          opacity: opacity\n        });\n\n        // add a single hop particle\n        link.__singleHopPhotonsObj.add(new three$1.Mesh(particleGeometry, particleMaterial));\n      }\n      return this;\n    },\n    getGraphBbox: function getGraphBbox(state) {\n      var nodeFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      if (!state.initialised) return null;\n\n      // recursively collect all nested geometries bboxes\n      var bboxes = function getBboxes(obj) {\n        var bboxes = [];\n        if (obj.geometry) {\n          obj.geometry.computeBoundingBox();\n          var box = new three$1.Box3();\n          box.copy(obj.geometry.boundingBox).applyMatrix4(obj.matrixWorld);\n          bboxes.push(box);\n        }\n        return bboxes.concat.apply(bboxes, _toConsumableArray((obj.children || []).filter(function (obj) {\n          return !obj.hasOwnProperty('__graphObjType') || obj.__graphObjType === 'node' && nodeFilter(obj.__data);\n        } // exclude filtered out nodes\n        ).map(getBboxes)));\n      }(state.graphScene);\n      if (!bboxes.length) return null;\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [min(bboxes, function (bb) {\n          return bb.min[c];\n        }), max(bboxes, function (bb) {\n          return bb.max[c];\n        })]);\n      })));\n    }\n  },\n  stateInit: function stateInit() {\n    return {\n      d3ForceLayout: forceSimulation().force('link', forceLink()).force('charge', forceManyBody()).force('center', forceCenter()).force('dagRadial', null).stop(),\n      engineRunning: false\n    };\n  },\n  init: function init(threeObj, state) {\n    // Main three object to manipulate\n    state.graphScene = threeObj;\n  },\n  update: function update(state, changedProps) {\n    var hasAnyPropChanged = function hasAnyPropChanged(propList) {\n      return propList.some(function (p) {\n        return changedProps.hasOwnProperty(p);\n      });\n    };\n    state.engineRunning = false; // pause simulation\n    state.onUpdate();\n    if (state.nodeAutoColorBy !== null && hasAnyPropChanged(['nodeAutoColorBy', 'graphData', 'nodeColor'])) {\n      // Auto add color to uncolored nodes\n      autoColorObjects(state.graphData.nodes, accessorFn(state.nodeAutoColorBy), state.nodeColor);\n    }\n    if (state.linkAutoColorBy !== null && hasAnyPropChanged(['linkAutoColorBy', 'graphData', 'linkColor'])) {\n      // Auto add color to uncolored links\n      autoColorObjects(state.graphData.links, accessorFn(state.linkAutoColorBy), state.linkColor);\n    }\n\n    // Digest nodes WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'nodeThreeObject', 'nodeThreeObjectExtend', 'nodeVal', 'nodeColor', 'nodeVisibility', 'nodeRelSize', 'nodeResolution', 'nodeOpacity'])) {\n      var customObjectAccessor = accessorFn(state.nodeThreeObject);\n      var customObjectExtendAccessor = accessorFn(state.nodeThreeObjectExtend);\n      var valAccessor = accessorFn(state.nodeVal);\n      var colorAccessor = accessorFn(state.nodeColor);\n      var visibilityAccessor = accessorFn(state.nodeVisibility);\n      var sphereGeometries = {}; // indexed by node value\n      var sphereMaterials = {}; // indexed by color\n\n      threeDigest(state.graphData.nodes.filter(visibilityAccessor), state.graphScene, {\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'nodeThreeObject', 'nodeThreeObjectExtend']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'node';\n        },\n        createObj: function createObj(node) {\n          var customObj = customObjectAccessor(node);\n          var extendObj = customObjectExtendAccessor(node);\n          if (customObj && state.nodeThreeObject === customObj) {\n            // clone object if it's a shared object among all nodes\n            customObj = customObj.clone();\n          }\n          var obj;\n          if (customObj && !extendObj) {\n            obj = customObj;\n          } else {\n            // Add default object (sphere mesh)\n            obj = new three$1.Mesh();\n            obj.__graphDefaultObj = true;\n            if (customObj && extendObj) {\n              obj.add(customObj); // extend default with custom\n            }\n          }\n\n          obj.__graphObjType = 'node'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(obj, node) {\n          if (obj.__graphDefaultObj) {\n            // bypass internal updates for custom node objects\n            var val = valAccessor(node) || 1;\n            var radius = Math.cbrt(val) * state.nodeRelSize;\n            var numSegments = state.nodeResolution;\n            if (!obj.geometry.type.match(/^Sphere(Buffer)?Geometry$/) || obj.geometry.parameters.radius !== radius || obj.geometry.parameters.widthSegments !== numSegments) {\n              if (!sphereGeometries.hasOwnProperty(val)) {\n                sphereGeometries[val] = new three$1.SphereGeometry(radius, numSegments, numSegments);\n              }\n              obj.geometry.dispose();\n              obj.geometry = sphereGeometries[val];\n            }\n            var color = colorAccessor(node);\n            var materialColor = new three$1.Color(colorStr2Hex(color || '#ffffaa'));\n            var opacity = state.nodeOpacity * colorAlpha(color);\n            if (obj.material.type !== 'MeshLambertMaterial' || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n              if (!sphereMaterials.hasOwnProperty(color)) {\n                sphereMaterials[color] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              obj.material.dispose();\n              obj.material = sphereMaterials[color];\n            }\n          }\n        }\n      });\n    }\n\n    // Digest links WebGL objects\n    if (state._flushObjects || hasAnyPropChanged(['graphData', 'linkThreeObject', 'linkThreeObjectExtend', 'linkMaterial', 'linkColor', 'linkWidth', 'linkVisibility', 'linkResolution', 'linkOpacity', 'linkDirectionalArrowLength', 'linkDirectionalArrowColor', 'linkDirectionalArrowResolution', 'linkDirectionalParticles', 'linkDirectionalParticleWidth', 'linkDirectionalParticleColor', 'linkDirectionalParticleResolution'])) {\n      var _customObjectAccessor = accessorFn(state.linkThreeObject);\n      var _customObjectExtendAccessor = accessorFn(state.linkThreeObjectExtend);\n      var customMaterialAccessor = accessorFn(state.linkMaterial);\n      var _visibilityAccessor = accessorFn(state.linkVisibility);\n      var _colorAccessor = accessorFn(state.linkColor);\n      var widthAccessor = accessorFn(state.linkWidth);\n      var cylinderGeometries = {}; // indexed by link width\n      var lambertLineMaterials = {}; // for cylinder objects, indexed by link color\n      var basicLineMaterials = {}; // for line objects, indexed by link color\n\n      var visibleLinks = state.graphData.links.filter(_visibilityAccessor);\n\n      // lines digest cycle\n      threeDigest(visibleLinks, state.graphScene, {\n        objBindAttr: '__lineObj',\n        purge: state._flushObjects || hasAnyPropChanged([\n        // recreate objects if any of these props have changed\n        'linkThreeObject', 'linkThreeObjectExtend', 'linkWidth']),\n        objFilter: function objFilter(obj) {\n          return obj.__graphObjType === 'link';\n        },\n        exitObj: function exitObj(obj) {\n          // remove trailing single photons\n          var singlePhotonsObj = obj.__data && obj.__data.__singleHopPhotonsObj;\n          if (singlePhotonsObj) {\n            singlePhotonsObj.parent.remove(singlePhotonsObj);\n            emptyObject(singlePhotonsObj);\n            delete obj.__data.__singleHopPhotonsObj;\n          }\n        },\n        createObj: function createObj(link) {\n          var customObj = _customObjectAccessor(link);\n          var extendObj = _customObjectExtendAccessor(link);\n          if (customObj && state.linkThreeObject === customObj) {\n            // clone object if it's a shared object among all links\n            customObj = customObj.clone();\n          }\n          var defaultObj;\n          if (!customObj || extendObj) {\n            // construct default line obj\n            var useCylinder = !!widthAccessor(link);\n            if (useCylinder) {\n              defaultObj = new three$1.Mesh();\n            } else {\n              // Use plain line (constant width)\n              var lineGeometry = new three$1.BufferGeometry();\n              lineGeometry[setAttributeFn]('position', new three$1.BufferAttribute(new Float32Array(2 * 3), 3));\n              defaultObj = new three$1.Line(lineGeometry);\n            }\n          }\n          var obj;\n          if (!customObj) {\n            obj = defaultObj;\n            obj.__graphDefaultObj = true;\n          } else {\n            if (!extendObj) {\n              // use custom object\n              obj = customObj;\n            } else {\n              // extend default with custom in a group\n              obj = new three$1.Group();\n              obj.__graphDefaultObj = true;\n              obj.add(defaultObj);\n              obj.add(customObj);\n            }\n          }\n          obj.renderOrder = 10; // Prevent visual glitches of dark lines on top of nodes by rendering them last\n\n          obj.__graphObjType = 'link'; // Add object type\n\n          return obj;\n        },\n        updateObj: function updateObj(updObj, link) {\n          if (updObj.__graphDefaultObj) {\n            // bypass internal updates for custom link objects\n            // select default object if it's an extended group\n            var obj = updObj.children.length ? updObj.children[0] : updObj;\n            var linkWidth = Math.ceil(widthAccessor(link) * 10) / 10;\n            var useCylinder = !!linkWidth;\n            if (useCylinder) {\n              var r = linkWidth / 2;\n              var numSegments = state.linkResolution;\n              if (!obj.geometry.type.match(/^Cylinder(Buffer)?Geometry$/) || obj.geometry.parameters.radiusTop !== r || obj.geometry.parameters.radialSegments !== numSegments) {\n                if (!cylinderGeometries.hasOwnProperty(linkWidth)) {\n                  var geometry = new three$1.CylinderGeometry(r, r, 1, numSegments, 1, false);\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeTranslation(0, 1 / 2, 0));\n                  geometry[applyMatrix4Fn](new three$1.Matrix4().makeRotationX(Math.PI / 2));\n                  cylinderGeometries[linkWidth] = geometry;\n                }\n                obj.geometry.dispose();\n                obj.geometry = cylinderGeometries[linkWidth];\n              }\n            }\n            var customMaterial = customMaterialAccessor(link);\n            if (customMaterial) {\n              obj.material = customMaterial;\n            } else {\n              var color = _colorAccessor(link);\n              var materialColor = new three$1.Color(colorStr2Hex(color || '#f0f0f0'));\n              var opacity = state.linkOpacity * colorAlpha(color);\n              var materialType = useCylinder ? 'MeshLambertMaterial' : 'LineBasicMaterial';\n              if (obj.material.type !== materialType || !obj.material.color.equals(materialColor) || obj.material.opacity !== opacity) {\n                var lineMaterials = useCylinder ? lambertLineMaterials : basicLineMaterials;\n                if (!lineMaterials.hasOwnProperty(color)) {\n                  lineMaterials[color] = new three$1[materialType]({\n                    color: materialColor,\n                    transparent: opacity < 1,\n                    opacity: opacity,\n                    depthWrite: opacity >= 1 // Prevent transparency issues\n                  });\n                }\n\n                obj.material.dispose();\n                obj.material = lineMaterials[color];\n              }\n            }\n          }\n        }\n      });\n\n      // Arrows digest cycle\n      if (state.linkDirectionalArrowLength || changedProps.hasOwnProperty('linkDirectionalArrowLength')) {\n        var arrowLengthAccessor = accessorFn(state.linkDirectionalArrowLength);\n        var arrowColorAccessor = accessorFn(state.linkDirectionalArrowColor);\n        threeDigest(visibleLinks.filter(arrowLengthAccessor), state.graphScene, {\n          objBindAttr: '__arrowObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'arrow';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Mesh(undefined, new three$1.MeshLambertMaterial({\n              transparent: true\n            }));\n            obj.__linkThreeObjType = 'arrow'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var arrowLength = arrowLengthAccessor(link);\n            var numSegments = state.linkDirectionalArrowResolution;\n            if (!obj.geometry.type.match(/^Cone(Buffer)?Geometry$/) || obj.geometry.parameters.height !== arrowLength || obj.geometry.parameters.radialSegments !== numSegments) {\n              var coneGeometry = new three$1.ConeGeometry(arrowLength * 0.25, arrowLength, numSegments);\n              // Correct orientation\n              coneGeometry.translate(0, arrowLength / 2, 0);\n              coneGeometry.rotateX(Math.PI / 2);\n              obj.geometry.dispose();\n              obj.geometry = coneGeometry;\n            }\n            var arrowColor = arrowColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            obj.material.color = new three$1.Color(colorStr2Hex(arrowColor));\n            obj.material.opacity = state.linkOpacity * 3 * colorAlpha(arrowColor);\n          }\n        });\n      }\n\n      // Photon particles digest cycle\n      if (state.linkDirectionalParticles || changedProps.hasOwnProperty('linkDirectionalParticles')) {\n        var particlesAccessor = accessorFn(state.linkDirectionalParticles);\n        var particleWidthAccessor = accessorFn(state.linkDirectionalParticleWidth);\n        var particleColorAccessor = accessorFn(state.linkDirectionalParticleColor);\n        var particleMaterials = {}; // indexed by link color\n        var particleGeometries = {}; // indexed by particle width\n\n        threeDigest(visibleLinks.filter(particlesAccessor), state.graphScene, {\n          objBindAttr: '__photonsObj',\n          objFilter: function objFilter(obj) {\n            return obj.__linkThreeObjType === 'photons';\n          },\n          createObj: function createObj() {\n            var obj = new three$1.Group();\n            obj.__linkThreeObjType = 'photons'; // Add object type\n\n            return obj;\n          },\n          updateObj: function updateObj(obj, link) {\n            var numPhotons = Math.round(Math.abs(particlesAccessor(link)));\n            var curPhoton = !!obj.children.length && obj.children[0];\n            var photonR = Math.ceil(particleWidthAccessor(link) * 10) / 10 / 2;\n            var numSegments = state.linkDirectionalParticleResolution;\n            var particleGeometry;\n            if (curPhoton && curPhoton.geometry.parameters.radius === photonR && curPhoton.geometry.parameters.widthSegments === numSegments) {\n              particleGeometry = curPhoton.geometry;\n            } else {\n              if (!particleGeometries.hasOwnProperty(photonR)) {\n                particleGeometries[photonR] = new three$1.SphereGeometry(photonR, numSegments, numSegments);\n              }\n              particleGeometry = particleGeometries[photonR];\n              curPhoton && curPhoton.geometry.dispose();\n            }\n            var photonColor = particleColorAccessor(link) || _colorAccessor(link) || '#f0f0f0';\n            var materialColor = new three$1.Color(colorStr2Hex(photonColor));\n            var opacity = state.linkOpacity * 3;\n            var particleMaterial;\n            if (curPhoton && curPhoton.material.color.equals(materialColor) && curPhoton.material.opacity === opacity) {\n              particleMaterial = curPhoton.material;\n            } else {\n              if (!particleMaterials.hasOwnProperty(photonColor)) {\n                particleMaterials[photonColor] = new three$1.MeshLambertMaterial({\n                  color: materialColor,\n                  transparent: true,\n                  opacity: opacity\n                });\n              }\n              particleMaterial = particleMaterials[photonColor];\n              curPhoton && curPhoton.material.dispose();\n            }\n\n            // digest cycle for each photon\n            threeDigest(_toConsumableArray(new Array(numPhotons)).map(function (_, idx) {\n              return {\n                idx: idx\n              };\n            }), obj, {\n              idAccessor: function idAccessor(d) {\n                return d.idx;\n              },\n              createObj: function createObj() {\n                return new three$1.Mesh(particleGeometry, particleMaterial);\n              },\n              updateObj: function updateObj(obj) {\n                obj.geometry = particleGeometry;\n                obj.material = particleMaterial;\n              }\n            });\n          }\n        });\n      }\n    }\n    state._flushObjects = false; // reset objects refresh flag\n\n    // simulation engine\n    if (hasAnyPropChanged(['graphData', 'nodeId', 'linkSource', 'linkTarget', 'numDimensions', 'forceEngine', 'dagMode', 'dagNodeFilter', 'dagLevelDistance'])) {\n      state.engineRunning = false; // Pause simulation\n\n      // parse links\n      state.graphData.links.forEach(function (link) {\n        link.source = link[state.linkSource];\n        link.target = link[state.linkTarget];\n      });\n\n      // Feed data to force-directed layout\n      var isD3Sim = state.forceEngine !== 'ngraph';\n      var layout;\n      if (isD3Sim) {\n        // D3-force\n        (layout = state.d3ForceLayout).stop().alpha(1) // re-heat the simulation\n        .numDimensions(state.numDimensions).nodes(state.graphData.nodes);\n\n        // add links (if link force is still active)\n        var linkForce = state.d3ForceLayout.force('link');\n        if (linkForce) {\n          linkForce.id(function (d) {\n            return d[state.nodeId];\n          }).links(state.graphData.links);\n        }\n\n        // setup dag force constraints\n        var nodeDepths = state.dagMode && getDagDepths(state.graphData, function (node) {\n          return node[state.nodeId];\n        }, {\n          nodeFilter: state.dagNodeFilter,\n          onLoopError: state.onDagError || undefined\n        });\n        var maxDepth = Math.max.apply(Math, _toConsumableArray(Object.values(nodeDepths || [])));\n        var dagLevelDistance = state.dagLevelDistance || state.graphData.nodes.length / (maxDepth || 1) * DAG_LEVEL_NODE_RATIO * (['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? 0.7 : 1);\n\n        // Fix nodes to x,y,z for dag mode\n        if (state.dagMode) {\n          var getFFn = function getFFn(fix, invert) {\n            return function (node) {\n              return !fix ? undefined : (nodeDepths[node[state.nodeId]] - maxDepth / 2) * dagLevelDistance * (invert ? -1 : 1);\n            };\n          };\n          var fxFn = getFFn(['lr', 'rl'].indexOf(state.dagMode) !== -1, state.dagMode === 'rl');\n          var fyFn = getFFn(['td', 'bu'].indexOf(state.dagMode) !== -1, state.dagMode === 'td');\n          var fzFn = getFFn(['zin', 'zout'].indexOf(state.dagMode) !== -1, state.dagMode === 'zout');\n          state.graphData.nodes.filter(state.dagNodeFilter).forEach(function (node) {\n            node.fx = fxFn(node);\n            node.fy = fyFn(node);\n            node.fz = fzFn(node);\n          });\n        }\n\n        // Use radial force for radial dags\n        state.d3ForceLayout.force('dagRadial', ['radialin', 'radialout'].indexOf(state.dagMode) !== -1 ? forceRadial(function (node) {\n          var nodeDepth = nodeDepths[node[state.nodeId]] || -1;\n          return (state.dagMode === 'radialin' ? maxDepth - nodeDepth : nodeDepth) * dagLevelDistance;\n        }).strength(function (node) {\n          return state.dagNodeFilter(node) ? 1 : 0;\n        }) : null);\n      } else {\n        // ngraph\n        var _graph = ngraph.graph();\n        state.graphData.nodes.forEach(function (node) {\n          _graph.addNode(node[state.nodeId]);\n        });\n        state.graphData.links.forEach(function (link) {\n          _graph.addLink(link.source, link.target);\n        });\n        layout = ngraph.forcelayout(_graph, _objectSpread2({\n          dimensions: state.numDimensions\n        }, state.ngraphPhysics));\n        layout.graph = _graph; // Attach graph reference to layout\n      }\n\n      for (var i = 0; i < state.warmupTicks && !(isD3Sim && state.d3AlphaMin > 0 && state.d3ForceLayout.alpha() < state.d3AlphaMin); i++) {\n        layout[isD3Sim ? \"tick\" : \"step\"]();\n      } // Initial ticks before starting to render\n\n      state.layout = layout;\n      this.resetCountdown();\n    }\n    state.engineRunning = true; // resume simulation\n\n    state.onFinishUpdate();\n  }\n});\n\nfunction fromKapsule (kapsule) {\n  var baseClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Object;\n  var initKapsuleWithSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n  var FromKapsule = /*#__PURE__*/function (_baseClass) {\n    _inherits(FromKapsule, _baseClass);\n    var _super = _createSuper(FromKapsule);\n    function FromKapsule() {\n      var _this;\n      _classCallCheck(this, FromKapsule);\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n      _this = _super.call.apply(_super, [this].concat(args));\n      _this.__kapsuleInstance = kapsule().apply(void 0, [].concat(_toConsumableArray(initKapsuleWithSelf ? [_assertThisInitialized(_this)] : []), args));\n      return _this;\n    }\n    return _createClass(FromKapsule);\n  }(baseClass); // attach kapsule props/methods to class prototype\n  Object.keys(kapsule()).forEach(function (m) {\n    return FromKapsule.prototype[m] = function () {\n      var _this$__kapsuleInstan;\n      var returnVal = (_this$__kapsuleInstan = this.__kapsuleInstance)[m].apply(_this$__kapsuleInstan, arguments);\n      return returnVal === this.__kapsuleInstance ? this // chain based on this class, not the kapsule obj\n      : returnVal;\n    };\n  });\n  return FromKapsule;\n}\n\nvar three = window.THREE ? window.THREE : {\n  Group: Group\n}; // Prefer consumption from global THREE, if exists\nvar threeForcegraph = fromKapsule(ForceGraph, three.Group, true);\n\nexport { threeForcegraph as default };\n"]},"metadata":{},"sourceType":"module"}